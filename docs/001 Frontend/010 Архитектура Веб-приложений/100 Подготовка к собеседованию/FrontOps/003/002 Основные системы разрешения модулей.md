---
title: Основные системы разрешения модулей
draft: true
tags:
  - JavaScript
  - Resolver
  - CommonJS
  - ESModules
  - webpack
  - Rspack
info: []
---
### CommonJS

```js
// Экспорт
module.exports = {
  sayHello: (name) => `Привет, ${name}!`,
}

// Импорт
const utils = require("./utils")
console.log(utils.sayHello("Мир")) // Привет, Мир!
```

**Особенности:**

- Использует `require` и `module.exports`
- Расширение файла можно не указывать
- Поддерживает расширения `.js`, `.json`
- При импорте папки ищется `index.js`
- Только синхронное подключение
- Можно вызывать `require` в любом месте кода

#### Алгоритм поиска в node_modules

Когда вы делаете `require('react')`, Node.js ищет модуль по следующему алгоритму:

1. Проверяет папку `node_modules` в текущей директории
2. Поднимается на уровень выше и проверяет там `node_modules`
3. Продолжает подниматься вверх до корня файловой системы

Дополнительно используются пути из:

- Переменной окружения `$NODE_PATH`
- Устаревших путей (`$HOME/.node_modules`, `$HOME/.node_libraries`)

CommonJS также предоставляет специальные константы:

- `__filename` — полный путь к текущему файлу
- `__dirname` — путь к директории текущего файла

### ES Modules (ESM)

```js
// Экспорт
export const sayHello = (name) => `Привет, ${name}!`
export default function greet() {
  return "Здравствуйте!"
}

// Импорт
import defaultGreeting, { sayHello } from "./greetings.js"
```

**Особенности:**

- Использует `import` и `export`
- Расширение файла **обязательно** указывать
- Поддерживает расширения `.js`, `.mjs`, `.cjs`
- Нельзя импортировать папку
- Поддерживает как синхронное, так и асинхронное подключение
- Статические импорты должны находиться на верхнем уровне модуля

#### Import Attributes

```js
// Импорт JSON с указанием типа
import config from "./config.json" with { type: "json" }

// Динамический импорт с атрибутами
import("./data.json", { with: { type: "json" } })
```

#### Системы алиасов

**Package.json imports:**

```json
{
  "imports": {
    "#utils": "./src/utils.js",
    "#components": "./src/components/index.js"
  }
}
```

```js
import { formatDate } from "#utils"
```

**Import maps (для браузера):**

```html
<script type="importmap">
  {
    "imports": {
      "components": "./src/components/index.js",
      "react": "https://esm.sh/react@18.2.0"
    }
  }
</script>
```

```js
import React from "react"
import { Button } from "components"
```

### TypeScript Paths

TypeScript позволяет настраивать пути в tsconfig.json:

```json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"],
      "@components/*": ["src/components/*"],
      "@utils/*": ["src/utils/*"]
    }
  }
}
```

```ts
import { Button } from "@components/ui"
import { formatDate } from "@utils/date"
```

### Webpack (Enhanced Resolve)

```js
// webpack.config.js
module.exports = {
  resolve: {
    extensions: [".js", ".jsx", ".ts", ".tsx", ".json"],
    alias: {
      "@": path.resolve(__dirname, "src"),
      "@components": path.resolve(__dirname, "src/components"),
    },
    modules: ["node_modules", "src"],
    fallback: {
      path: require.resolve("path-browserify"),
    },
  },
}
```

Важно размещать часто используемые расширения в начале массива `extensions` для оптимизации скорости сборки.

### Rspack и современные решения

Rspack использует Oxc resolver — реализацию на Rust, совместимую с API enhanced-resolve:

```js
// rspack.config.js
module.exports = {
  resolve: {
    extensions: [".js", ".jsx", ".ts", ".tsx"],
    alias: {
      "@": path.resolve(__dirname, "src"),
    },
  },
}
```

___

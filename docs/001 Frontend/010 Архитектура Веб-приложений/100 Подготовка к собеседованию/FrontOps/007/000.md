# Ассеты в Frontend-сборке

## Введение: Что такое ассеты?

**Ассеты** — это не-JavaScript ресурсы, которые включаются в приложение: изображения, шрифты, CSS, видео, аудио, JSON, SVG, шаблоны и другие файлы. Задача сборщика — интерпретировать ассет как обычный модуль сборки, обеспечивая их правильную обработку и оптимизацию.

## 1. Нативные способы подключения ассетов

### Без сборщика
- **Изображения**: ссылка через атрибут `src` в HTML или `url()` в CSS
- **Шрифты**: подключение через `@font-face` с `url()` в CSS
- **CSS**: прямая ссылка на файл или inline-стили

### Способы загрузки
- **HTTP/HTTPS адрес** — внешняя ссылка на ресурс
- **Inline** — встраивание через `data:` URI в HTML/CSS/JS
- **CDN/S3** — размещение на внешних сервисах для ускорения загрузки

## 2. Ассеты вне сборки

### Copy Plugin подход
```js
// Webpack Copy Plugin
const CopyPlugin = require('copy-webpack-plugin');

module.exports = {
  plugins: [
    new CopyPlugin({
      patterns: [
        { from: 'src/assets', to: 'dist/assets' }
      ]
    })
  ]
};
```

```js
// Vite copy
import { defineConfig } from 'vite';

export default defineConfig({
  publicDir: 'public', // копируется как есть
  build: {
    rollupOptions: {
      input: {
        main: resolve(__dirname, 'index.html')
      }
    }
  }
});
```

### Проблемы ассетов вне сборки
- **Слабая связность** — нет связи между кодом и ассетами
- **Сложность процессинга** — ручная обработка каждого файла
- **Ручное управление инлайном** — нет автоматизации

## 3. Ассеты в сборке

### Преимущества
- **Сильная связность** — `import` = ассет
- **Локальное хранение** — ассеты рядом с компонентами
- **Автоматическое удаление** — неиспользуемые ассеты исключаются
- **Процессинг** — сжатие, конвертация, оптимизация
- **Автоматический инлайн** — встраивание мелких файлов

### Как работает импорт ассета

```js
// Импорт изображения
import logoUrl from './logo.png';
document.getElementById('logo').src = logoUrl;

// Динамический импорт с URL
const imgUrl = new URL('./img.png', import.meta.url).href;
document.getElementById('hero-img').src = imgUrl;

// Импорт с query параметрами
import imgUrl from './image.png?inline'; // Vite
import imgUrl from './image.png?url';    // Webpack
```

### Преобразование ассета
1. **Генерация ассета** в `dist/`
2. **Base64 кодирование** (для инлайна)
3. **Модуль экспортирует** внешнюю ссылку или inline-содержимое

## 4. Процессинг ассетов

### Когда делать процессинг
- **Вне сборки** — сохранять результат в репозитории
- **В сборке** — хранить исходники в высоком качестве, обрабатывать автоматически

### Оптимизация и сжатие

#### Изображения
```js
// Sharp для изменения размера
import sharp from 'sharp';

sharp('input.jpg')
  .resize(800, 600)
  .jpeg({ quality: 80 })
  .toFile('output.jpg');

// Imagemin для сжатия
import imagemin from 'imagemin';
import imageminMozjpeg from 'imagemin-mozjpeg';

await imagemin(['images/*.{jpg,png}'], {
  destination: 'build/images',
  plugins: [imageminMozjpeg({ quality: 80 })]
});
```

#### CSS
```js
// CSSnano для минификации
import cssnano from 'cssnano';

postcss([cssnano()])
  .process(css)
  .then(result => console.log(result.css));
```

#### SVG
```js
// SVGO для оптимизации SVG
import { optimize } from 'svgo';

const result = optimize(svgString, {
  plugins: [
    'removeViewBox',
    'removeDimensions',
    'removeUselessStrokeAndFill'
  ]
});
```

#### Шрифты
```js
// Subsetting шрифтов
import fontTools from 'fonttools';

// Удаление неиспользуемых глифов
const subset = fontTools.subset(fontBuffer, text);
```

### Конвертация размеров
```js
// Генерация responsive изображений
const sizes = [320, 640, 1024, 1920];
const formats = ['webp', 'avif', 'jpg'];

for (const size of sizes) {
  for (const format of formats) {
    await sharp('input.jpg')
      .resize(size)
      .toFormat(format)
      .toFile(`output-${size}.${format}`);
  }
}
```

### Конвертация форматов
```js
// Современные форматы
const modernFormats = {
  webp: { quality: 80 },
  avif: { quality: 50 }
};

// HTML с fallback
<img 
  src="image.jpg" 
  srcset="image.webp" 
  type="image/webp"
  alt="Description"
/>
```

## 5. Генерация оптимальной разметки

### Next.js Image
```jsx
import Image from 'next/image';

<Image
  src="/hero.jpg"
  alt="Hero image"
  width={800}
  height={600}
  priority
  placeholder="blur"
  blurDataURL="data:image/jpeg;base64,..."
/>
```

### Nuxt Image
```vue
<template>
  <NuxtImg
    src="/hero.jpg"
    alt="Hero image"
    width="800"
    height="600"
    loading="lazy"
    format="webp"
  />
</template>
```

## 6. Общая библиотека ассетов

### Дизайн-система подход
```json
{
  "name": "@company/design-assets",
  "version": "1.2.0",
  "main": "index.js",
  "files": [
    "icons/",
    "images/",
    "fonts/"
  ]
}
```

```js
// Использование
import { Logo, IconUser } from '@company/design-assets';

// Или прямая ссылка на CDN
const logoUrl = 'https://cdn.company.com/assets/v1.2.0/logo.svg';
```

## 7. Синтаксис обработки ассетов

### Import Query
```js
// Vite
import imgUrl from './image.png?inline';
import imgUrl from './image.png?url';
import imgUrl from './image.png?raw';

// Webpack
import imgUrl from './image.png?inline';
import imgUrl from './image.png?url';
```

### Конфигурация в сборщиках

#### Webpack
```js
module.exports = {
  module: {
    rules: [
      {
        test: /\.(png|jpe?g|gif|svg)$/,
        type: 'asset',
        parser: {
          dataUrlCondition: {
            maxSize: 8 * 1024 // 8kb
          }
        },
        generator: {
          filename: 'images/[name].[hash][ext]'
        }
      }
    ]
  }
};
```

#### Vite
```js
export default defineConfig({
  assetsInclude: ['**/*.glb', '**/*.gltf'],
  build: {
    assetsInlineLimit: 4096, // 4kb
    rollupOptions: {
      output: {
        assetFileNames: 'assets/[name].[hash].[ext]'
      }
    }
  }
});
```

#### Rollup
```js
import url from '@rollup/plugin-url';

export default {
  plugins: [
    url({
      limit: 14 * 1024, // 14kb
      include: ['**/*.png', '**/*.jpg'],
      fileName: 'assets/[name].[hash][extname]'
    })
  ]
};
```

#### Esbuild
```js
import esbuild from 'esbuild';

esbuild.build({
  entryPoints: ['src/index.js'],
  bundle: true,
  loader: {
    '.png': 'file',
    '.jpg': 'file',
    '.svg': 'text'
  },
  plugins: [
    // esbuild-plugin-inline-image
    // esbuild-plugin-inline-import
  ]
});
```

## 8. CDN и S3 интеграция

### Настройка publicPath
```js
// Webpack
module.exports = {
  output: {
    publicPath: process.env.NODE_ENV === 'production' 
      ? 'https://cdn.example.com/' 
      : '/'
  }
};

// Vite
export default defineConfig({
  base: process.env.NODE_ENV === 'production' 
    ? 'https://cdn.example.com/' 
    : '/'
});
```

### CI/CD загрузка
```yaml
# GitHub Actions
- name: Upload to S3
  uses: aws-actions/configure-aws-credentials@v1
  with:
    aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
    aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
    aws-region: us-east-1

- name: Sync files
  run: aws s3 sync dist/ s3://my-bucket --delete
```

---

# Вопросы для собеседований по ассетам

## 1. Основные понятия

- Что такое ассеты и чем они отличаются от JavaScript модулей?
- Какие типы ассетов вы знаете?
- В чем разница между ассетами вне сборки и в сборке?
- Что такое inline ассеты и когда их использовать?
- Как работает data: URI схема?

## 2. Подключение ассетов

- Как подключить изображение в React компоненте?
- В чем разница между import и require для ассетов?
- Как работает new URL() для динамических ассетов?
- Что такое import query и зачем он нужен?
- Как настроить алиасы для ассетов в Vite/Webpack?

## 3. Процессинг и оптимизация

- Какие инструменты используются для сжатия изображений?
- Как оптимизировать SVG файлы?
- Что такое subsetting шрифтов?
- Как генерировать responsive изображения?
- В чем разница между WebP и AVIF форматами?

## 4. Сборщики и ассеты

- Как настроить обработку ассетов в Webpack?
- Чем отличается asset/resource от asset/inline в Webpack?
- Как работает автоматический инлайн в разных сборщиках?
- Как настроить копирование ассетов в Vite?
- Какие ограничения у esbuild для работы с ассетами?

## 5. CDN и деплой

- Как настроить publicPath для CDN?
- В чем разница между S3 и CDN?
- Как организовать загрузку ассетов в CI/CD?
- Как избежать проблем с кэшированием ассетов?
- Что такое cache busting для ассетов?

## 6. Современные подходы

- Как работает Next.js Image компонент?
- Что такое blur placeholder?
- Как организовать общую библиотеку ассетов?
- В чем преимущества дизайн-системы для ассетов?
- Как автоматизировать генерацию разметки для изображений?

## 7. Производительность

- Как измерить размер ассетов в бандле?
- Какие ассеты стоит инлайнить?
- Как оптимизировать загрузку шрифтов?
- Что такое critical CSS и как его выделить?
- Как использовать preload для критичных ассетов?

## 8. Практические задачи

- Напишите конфигурацию Webpack для обработки изображений
- Как настроить автоматическую конвертацию в WebP?
- Реализуйте lazy loading для изображений
- Настройте копирование ассетов в Vite
- Организуйте структуру ассетов в большом проекте

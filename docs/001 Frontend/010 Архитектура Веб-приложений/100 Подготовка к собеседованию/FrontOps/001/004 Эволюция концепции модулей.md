---
title: Эволюция концепции модулей
draft: true
tags:
  - IIFE
  - build
  - AMD
  - CommonJS
  - NodeJS
  - RequireJS
info:
---
## Эволюция концепции модулей

### IIFE (Immediately Invoked Function Expression)

Паттерн `IIFE` решал проблему загрязнения глобального пространства имен:

javascript

```js
// Модуль калькулятора
var Calculator = (function() {
    // Приватные переменные
    var history = [];
    
    // Приватные функции
    function log(operation, result) {
        history.push(operation + ' = ' + result);
    }
    
    // Публичный API
    return {
        add: function(a, b) {
            var result = a + b;
            log(a + ' + ' + b, result);
            return result;
        },
        
        subtract: function(a, b) {
            var result = a - b;
            log(a + ' - ' + b, result);
            return result;
        },
        
        getHistory: function() {
            return history.slice(); // Возвращаем копию
        }
    };
})();

// Использование
Calculator.add(5, 3); // 8
Calculator.getHistory(); // ["5 + 3 = 8"]
```

### AMD и RequireJS

Asynchronous Module Definition (AMD) позволял асинхронную загрузку модулей:

```JS
// math.js - определение модуля
define('math', [], function() {
    return {
        add: function(a, b) {
            return a + b;
        },
        multiply: function(a, b) {
            return a * b;
        }
    };
});

// app.js - использование модуля
require(['math'], function(math) {
    console.log(math.add(2, 3)); // 5
    console.log(math.multiply(4, 5)); // 20
});
```

RequireJS конфигурация:

```JS
requirejs.config({
    baseUrl: 'js/lib',
    paths: {
        'jquery': 'jquery-3.6.0.min',
        'lodash': 'lodash.min',
        'backbone': 'backbone-min'
    },
    shim: {
        'backbone': {
            deps: ['lodash', 'jquery'],
            exports: 'Backbone'
        }
    }
});
```

### CommonJS в Node.js

Node.js принес серверную модульность в JavaScript:

```JS
// utils.js
const path = require('path');
const fs = require('fs');

function readConfig(configPath) {
    const fullPath = path.resolve(configPath);
    const content = fs.readFileSync(fullPath, 'utf8');
    return JSON.parse(content);
}

function formatDate(date) {
    return date.toISOString().split('T')[0];
}

module.exports = {
    readConfig,
    formatDate
};

// app.js
const { readConfig, formatDate } = require('./utils');
const express = require('express');

const config = readConfig('./config.json');
console.log('Сегодня:', formatDate(new Date()));

const app = express();
app.listen(config.port);
```

___

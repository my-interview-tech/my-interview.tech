---
title: Как проверить какие пакеты в проекте устарели
draft: false
tags:
  - "#NodeJS"
  - "#npm"
  - "#зависимости"
  - "#обновление"
  - "#DevOps"
info:
  - "[Документация npm outdated](https://docs.npmjs.com/cli/v8/commands/npm-outdated)"
  - "[Руководство по npm-check-updates](https://github.com/raineorshine/npm-check-updates)"
  - "[Блог npm о безопасном обновлении зависимостей](https://blog.npmjs.org/post/161081169345/v500)"
---

В современной разработке на Node.js поддержание актуальности зависимостей является важной частью безопасности и стабильности проекта. Существует несколько встроенных и сторонних инструментов для проверки устаревших пакетов.

## Встроенные инструменты npm

### 1. npm outdated

**`npm outdated`** — встроенная команда, которая выводит список устаревших пакетов в вашем проекте, показывая текущие и последние доступные версии.

```bash
npm outdated
```

Команда выводит таблицу с информацией:

- **`Package`** — название пакета
- **`Current`** — текущая установленная версия
- **`Wanted`** — версия, соответствующая семантическому диапазону в package.json
- **`Latest`** — последняя доступная версия в репозитории npm
- **`Location`** — путь к пакету в node_modules

Пример вывода:

```
Package       Current  Wanted  Latest  Location
express       4.17.1   4.17.3  4.18.2  node_modules/express
lodash        4.17.15  4.17.21 4.17.21 node_modules/lodash
react         17.0.2   17.0.2  18.2.0  node_modules/react
typescript    4.5.5    4.5.5   5.0.4   node_modules/typescript
```

В этом примере:

- `express` можно обновить до 4.17.3 в рамках текущего диапазона версий
- `lodash` можно обновить до 4.17.21
- `react` и `typescript` имеют доступные мажорные обновления, но они не входят в диапазон версий, указанный в package.json

### 2. Обновление пакетов с помощью npm update

Для обновления пакетов до версий, соответствующих диапазонам в package.json (колонка "Wanted"):

```bash
# Обновление всех пакетов до версий, соответствующих package.json
npm update

# Обновление конкретного пакета
npm update express
```

### 3. Использование npm audit

Для проверки устаревших пакетов с точки зрения безопасности:

```bash
npm audit
```

Это покажет информацию о уязвимостях в зависимостях и рекомендации по обновлению.

## Сторонние инструменты

### 1. npm-check-updates (ncu)

**npm-check-updates** — популярный инструмент для обновления всех зависимостей до последних версий, включая мажорные обновления.

#### Установка:

```bash
# Глобальная установка
npm install -g npm-check-updates

# Или использование через npx без установки
npx npm-check-updates
```

#### Проверка доступных обновлений:

```bash
# Если установлен глобально
ncu

# Или через npx
npx npm-check-updates
```

Пример вывода:

```
Checking package.json
[====================] 15/15 100%

 express     ^4.17.1  →  ^4.18.2
 lodash     ^4.17.15  →  ^4.17.21
 react       ^17.0.2  →   ^18.2.0
 typescript   ^4.5.5  →    ^5.0.4

Run ncu -u to upgrade package.json
```

#### Обновление package.json:

```bash
# Обновление всех зависимостей в package.json
ncu -u

# Обновление только определенных пакетов
ncu -u express lodash

# Обновление только не-мажорных версий
ncu -u --target minor
```

После обновления package.json необходимо установить новые версии пакетов:

```bash
npm install
```

### 2. npm-check

**npm-check** — альтернативный инструмент с интерактивным интерфейсом выбора пакетов для обновления.

```bash
# Установка
npm install -g npm-check

# Проверка и обновление
npm-check -u
```

## Стратегии обновления зависимостей

### 1. Поэтапное обновление

Лучшая практика — обновлять зависимости постепенно:

1. Сначала обновите патч-версии (`npm update`)
2. Затем обновите минорные версии
3. Обновляйте мажорные версии по одной, с тестированием после каждого обновления

### 2. Автоматизация в CI/CD

Включите проверку устаревших пакетов в ваш CI/CD процесс:

```bash
# Проверка наличия обновлений безопасности
npm audit --audit-level=high

# Или с использованием npm-check-updates
npx npm-check-updates --errorLevel 1
```

### 3. Настройка зависимостей в package.json

Правильно указывайте диапазоны версий в package.json:

- `^` — разрешает обновления минорных и патч-версий (рекомендуется для большинства библиотек)
- `~` — разрешает только патч-обновления (для критических библиотек)
- Точная версия (`1.2.3`) — для библиотек, требующих строгого контроля версий

## Лучшие практики

1. **Регулярные проверки**: выполняйте `npm outdated` и `npm audit` регулярно
2. **Поэтапные обновления**: сначала обновляйте зависимости с уязвимостями безопасности
3. **Тестирование**: всегда запускайте тесты после обновления зависимостей
4. **Документирование**: ведите журнал обновлений зависимостей
5. **Автоматизация**: используйте инструменты вроде Dependabot или Renovate для автоматических PR с обновлениями

## Заключение

Поддержание актуальности зависимостей — важный аспект сопровождения Node.js-проектов, который повышает безопасность, производительность и облегчает будущие обновления. Регулярно выполняйте проверки с помощью `npm outdated`, `npm audit` и специализированных инструментов вроде npm-check-updates для поддержания здоровой кодовой базы.

---

[[003 JSCore|Назад]]

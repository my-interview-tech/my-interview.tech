---
title: Какие события существуют у WebSocket-соединения и для чего они используются
draft: true
tags: NodeJS
info:
---
У WebSocket-соединения в Node.js, используя библиотеку **`ws`**, существует несколько основных событий, которые помогают отслеживать различные этапы жизненного цикла соединения. Вот список этих событий и их назначение:

### 1. **`open`**

**Описание**: Срабатывает, когда WebSocket-соединение успешно установлено с сервером. **Использование**: Это событие часто используется для выполнения операций после установления соединения, например, отправки первоначальных сообщений на сервер.

javascript

КопироватьРедактировать

`ws.on('open', () => {   console.log('Соединение установлено'); });`

### 2. **`message`**

**Описание**: Срабатывает, когда WebSocket-соединение получает сообщение от сервера (или клиента, в зависимости от направления). **Использование**: Используется для обработки данных, полученных через WebSocket.

javascript

КопироватьРедактировать

`ws.on('message', (data) => {   console.log('Получено сообщение:', data); });`

### 3. **`error`**

**Описание**: Срабатывает при ошибках, связанных с соединением WebSocket. **Использование**: Это событие помогает отлавливать и обрабатывать ошибки, такие как проблемы с сетью, сервером или неправильные данные.

javascript

КопироватьРедактировать

`ws.on('error', (err) => {   console.error('Ошибка WebSocket:', err); });`

### 4. **`close`**

**Описание**: Срабатывает, когда соединение закрывается. Это может происходить как по инициативе клиента, так и сервера. **Использование**: Используется для выполнения операций при закрытии соединения, таких как очистка ресурсов или уведомление об отключении.

javascript

КопироватьРедактировать

`ws.on('close', () => {   console.log('Соединение закрыто'); });`

### 5. **`ping`** (редко используется)

**Описание**: Срабатывает, когда сервер посылает **ping**-сообщение для проверки состояния соединения. **Использование**: В большинстве случаев обработка этого события не требуется, так как библиотека **`ws`** автоматически отвечает на **ping** сообщением **pong**. Однако можно настроить обработчик, если нужно вручную обрабатывать такие события.

javascript

КопироватьРедактировать

`ws.on('ping', () => {   console.log('Получен ping-сигнал от сервера'); });`

### 6. **`pong`** (редко используется)

**Описание**: Срабатывает, когда сервер или клиент получает **pong**-ответ на своё **ping**-сообщение. **Использование**: Обычно используется для управления активностью соединения и проверки живости. Обычно не требуется вручную обрабатывать это событие, так как библиотека **`ws`** автоматически отвечает на **ping**-сигнал.

javascript

КопироватьРедактировать

`ws.on('pong', () => {   console.log('Получен pong-сигнал'); });`

### Пример использования событий:

javascript

КопироватьРедактировать

`const WebSocket = require('ws');  // Создание WebSocket-сервера const wss = new WebSocket.Server({ port: 8080 });  wss.on('connection', (ws) => {   console.log('Новое соединение установлено');    ws.on('open', () => {     console.log('Соединение открыто');   });    ws.on('message', (message) => {     console.log('Получено сообщение:', message);   });    ws.on('error', (err) => {     console.error('Ошибка WebSocket:', err);   });    ws.on('close', () => {     console.log('Соединение закрыто');   });    // Отправка сообщения клиенту   ws.send('Привет, клиент!'); });`

### Резюме:

- **`open`** — сигнал о начале соединения.
- **`message`** — получение данных.
- **`error`** — ошибка соединения.
- **`close`** — сигнал о закрытии соединения.
- **`ping`/`pong`** — используются для поддержания связи между клиентом и сервером.

Эти события помогают эффективно управлять WebSocket-соединениями, отслеживать их состояние и правильно обрабатывать возникающие ошибки или отключения.
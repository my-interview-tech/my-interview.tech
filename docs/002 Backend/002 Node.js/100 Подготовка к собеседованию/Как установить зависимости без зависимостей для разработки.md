---
title: Как установить зависимости без зависимостей для разработки
draft: false
tags:
  - "#NodeJS"
  - "#npm"
  - "#пакеты"
  - "#зависимости"
  - "#production"
info:
  - "[Документация npm install](https://docs.npmjs.com/cli/v9/commands/npm-install#--production)"
  - "[Документация переменных окружения npm](https://docs.npmjs.com/cli/v9/using-npm/config#node_env)"
---

Для установки только основных зависимостей проекта (без зависимостей для разработки) существует несколько способов, которые помогут оптимизировать производственную среду.

## Установка с флагом --production

Самый распространенный способ установить зависимости без devDependencies – использовать флаг `--production`:

```bash
npm install --production
```

В npm версии 7 и выше также можно использовать альтернативный синтаксис:

```bash
npm install --omit=dev
```

## Использование переменной окружения NODE_ENV

Другой способ – установить переменную окружения `NODE_ENV=production`:

### В Linux или macOS:

```bash
NODE_ENV=production npm install
```

### В Windows (cmd):

```bash
set NODE_ENV=production
npm install
```

### В Windows (PowerShell):

```bash
$env:NODE_ENV="production"
npm install
```

## Как это работает

Когда вы используете флаг `--production` или устанавливаете `NODE_ENV=production`, npm устанавливает только пакеты из раздела `dependencies` в вашем `package.json`, игнорируя `devDependencies`.

### Пример файла package.json:

```json
{
  "name": "my-app",
  "version": "1.0.0",
  "dependencies": {
    "express": "^4.17.1",
    "mongoose": "^5.13.7"
  },
  "devDependencies": {
    "nodemon": "^2.0.12",
    "jest": "^27.0.6",
    "eslint": "^7.32.0"
  }
}
```

После запуска `npm install --production` будут установлены только `express` и `mongoose`, а `nodemon`, `jest` и `eslint` установлены не будут.

## Для CI/CD пайплайнов и Docker

Этот подход особенно полезен в CI/CD пайплайнах и при создании Docker-образов:

```dockerfile
FROM node:14

WORKDIR /app
COPY package*.json ./

# Устанавливаем только production-зависимости
RUN npm install --production

COPY . .
CMD ["node", "app.js"]
```

## Использование команды npm ci

Для более детерминированной установки в CI-средах можно использовать:

```bash
npm ci --production
```

Команда `npm ci` устанавливает зависимости в точном соответствии с файлом `package-lock.json`, что гарантирует более стабильные установки.

## Проверка установленных зависимостей

Чтобы проверить, какие зависимости установлены:

```bash
npm list --prod --depth=0
```

## Преимущества установки без dev-зависимостей

- **Меньший размер**: production-сборка занимает меньше места
- **Безопасность**: меньше сторонних пакетов означает меньше потенциальных уязвимостей
- **Производительность**: быстрее запуск и меньше расход памяти
- **Скорость установки**: установка проходит быстрее

## Для других пакетных менеджеров

### Yarn:

```bash
yarn install --production
# или
yarn --production
```

### pnpm:

```bash
pnpm install --prod
```

---

[[002 Node.js|Назад]]

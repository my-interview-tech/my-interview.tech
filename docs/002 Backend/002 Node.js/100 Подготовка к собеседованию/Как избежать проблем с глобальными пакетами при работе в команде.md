---
title: Как избежать проблем с глобальными пакетами при работе в команде
draft: false
tags:
  - "#NodeJS"
  - "#npm"
  - "#package.json"
  - "#зависимости"
  - "#devDependencies"
info:
  - https://docs.npmjs.com/cli/v9/configuring-npm/package-json
  - https://docs.npmjs.com/downloading-and-installing-packages-locally
  - https://docs.npmjs.com/cli/v9/commands/npx
---

При разработке проектов на Node.js в команде часто возникают проблемы, связанные с глобальными пакетами. Разные версии пакетов у разных разработчиков могут приводить к нестабильной работе проекта, сложностям с деплоем и неожиданным ошибкам.

## Основные проблемы с глобальными пакетами

1. **Разные версии пакетов** у членов команды
2. **Отсутствие зависимостей** в явном виде в package.json
3. **Проблемы при деплое**, когда на сервере отсутствуют нужные пакеты
4. **Неявные зависимости**, которые затрудняют понимание структуры проекта

## Решения для избежания проблем

### 1. Используйте локальные зависимости вместо глобальных

Устанавливайте все необходимые пакеты локально в проект:

```bash
# Вместо глобальной установки
npm install --save-dev webpack

# Или для продакшн-зависимостей
npm install --save express
```

### 2. Используйте npm-скрипты в package.json

Создавайте скрипты для выполнения задач, которые используют локальные пакеты:

```json
{
  "scripts": {
    "build": "webpack --config webpack.config.js",
    "test": "jest",
    "start": "node server.js",
    "lint": "eslint ."
  }
}
```

Запускайте их командой:

```bash
npm run build
npm run test
```

### 3. Используйте npx для запуска локально установленных пакетов

Инструмент `npx` позволяет запускать бинарные файлы пакетов, установленных локально, без необходимости прописывать полный путь:

```bash
npx webpack --config webpack.config.js
```

### 4. Документируйте все зависимости в package.json

Убедитесь, что все необходимые пакеты указаны в `dependencies` или `devDependencies`:

```json
{
  "dependencies": {
    "express": "^4.18.2"
  },
  "devDependencies": {
    "webpack": "^5.75.0",
    "jest": "^29.3.1",
    "eslint": "^8.30.0"
  }
}
```

### 5. Используйте package-lock.json или yarn.lock

Эти файлы гарантируют, что все члены команды используют одинаковые версии пакетов:

```bash
# Для npm
npm ci

# Для yarn
yarn install --frozen-lockfile
```

### 6. Настройте правильное окружение для CI/CD

Для систем непрерывной интеграции/деплоя указывайте явное выполнение установки зависимостей:

```yaml
# Пример для GitHub Actions
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Use Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "18.x"
      - run: npm ci
      - run: npm run build
      - run: npm test
```

### 7. Используйте Docker для стандартизации окружения

Создайте `Dockerfile` для гарантии одинакового окружения для всех:

```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build
EXPOSE 3000
CMD ["npm", "start"]
```

### 8. Используйте nvm для контроля версий Node.js

Укажите версию Node.js в файле `.nvmrc`:

```
18.12.1
```

И используйте её в команде:

```bash
nvm use
```

## Преимущества локального подхода

1. **Воспроизводимость**: одинаковое поведение на всех машинах
2. **Изоляция**: разные проекты могут использовать разные версии пакетов
3. **Документирование**: явное указание всех зависимостей
4. **Легкая настройка**: новым участникам не нужно устанавливать множество глобальных пакетов

---

[[002 Node.js|Назад]]

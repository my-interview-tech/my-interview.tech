---
title: Что произошло с пакетом left-pad и какие выводы были сделаны из этого инцидента
draft: false
tags:
  - "#NodeJS"
  - "#npm"
  - "#left-pad"
  - "#зависимости"
  - "#микропакеты"
  - "#безопасность"
  - "#экосистема"
info:
  - https://habr.com/ru/articles/280039/
  - https://blog.npmjs.org/post/141577284765/kik-left-pad-and-npm
  - https://qz.com/646467/how-one-programmer-broke-the-internet-by-deleting-a-tiny-piece-of-code
---

# Инцидент с left-pad: история и последствия

**23 марта 2016 года** разработчик **Азер Кочулу (Azer Koçulu)** удалил свой пакет `left-pad` из npm-реестра. Этот пакет содержал всего **11 строк кода** для добавления отступов слева к строке, но его удаление привело к масштабному сбою в экосистеме JavaScript, затронув такие проекты как **React**, **Babel**, **Node.js** и тысячи других приложений.

## Код пакета left-pad

Весь пакет содержал всего 11 строк кода:

```javascript
module.exports = leftpad

function leftpad(str, len, ch) {
  str = String(str)

  var i = -1

  if (!ch && ch !== 0) ch = " "
  len = len - str.length

  while (++i < len) {
    str = ch + str
  }

  return str
}
```

Этот простой код добавлял к строке символы слева до достижения заданной длины.

## Хронология инцидента

### Предыстория

1. **Азер Кочулу** был активным разработчиком с более чем **250 пакетами** в npm-реестре.
2. Один из его пакетов назывался **"kik"** (инструмент командной строки).
3. Компания **Kik Interactive Inc.** (разработчик популярного мессенджера Kik) связалась с Азером с просьбой переименовать пакет.
4. После отказа Азера, Kik обратились в npm Inc. с претензией о нарушении торговой марки.

### Удаление пакетов

1. **npm Inc.** передала право на имя "kik" компании Kik Interactive, не получив согласия Азера.
2. В знак протеста **Азер удалил все свои пакеты** из npm-реестра (более 250).
3. Среди удалённых пакетов оказался `left-pad`, который на тот момент:
   - Имел **более 2 миллионов загрузок в месяц**
   - Использовался в качестве зависимости во множестве популярных проектов

### Последствия

1. **Сбой каскадного типа**:

   - Пакет `react-native` зависел от `babel-preset-react-native`
   - `babel-preset-react-native` зависел от `babel-core`
   - `babel-core` зависел от `left-pad`
   - При сборке проектов на основе React Native система не могла найти `left-pad`

2. **Масштаб проблемы**:

   - Десятки тысяч приложений перестали собираться
   - Разработчики по всему миру столкнулись с ошибками вида `Error: Cannot find module 'left-pad'`
   - GitHub сообщал о тысячах issues, связанных с этой проблемой

3. **Экстренные меры npm**:
   - npm восстановил пакет `left-pad@0.0.3` в реестре через несколько часов
   - Пакет был "распубликован" (unpublished) без удаления его содержимого
   - npm передал контроль над пакетом сообществу

## Технические причины сбоя

### Особенности системы зависимостей npm

1. **Транзитивные зависимости**: пакеты могут зависеть от других пакетов, создавая длинные цепочки зависимостей
2. **Отсутствие локального кэширования**: при сборке проектов npm заново скачивал пакеты
3. **Централизация**: единственный отказ в центральном реестре затронул всю экосистему
4. **Микропакеты**: практика создания крошечных пакетов для одной функции создала излишнюю фрагментацию

### Схема распространения сбоя

```
Приложение
  ├── react          → не может установиться
  │    └── babel     → не может установиться
  │         └── ...
  │              └── left-pad  → 404 Not Found
  │
  ├── webpack        → не может установиться
  │    └── ...
  │         └── left-pad  → 404 Not Found
  │
  └── другие пакеты  → не могут установиться
        └── ...
            └── left-pad  → 404 Not Found
```

## Изменения после инцидента

### 1. Изменения в политике npm

- **Правило "невозможности удаления"**: пакеты, от которых зависят другие пакеты, нельзя полностью удалить
- **Временное окно**: автор может отозвать пакет только в течение 24 часов после публикации
- **Восстановление пакетов**: npm может восстанавливать критически важные пакеты
- **Формализация процедуры разрешения конфликтов** с торговыми марками

### 2. Технические изменения в экосистеме

- **Появление Yarn** (2016): альтернативный пакетный менеджер от Facebook с локальным кэшированием и lock-файлами
- **npm shrinkwrap/package-lock.json**: механизм фиксации точных версий зависимостей
- **Рост популярности монорепозиториев**: инструменты вроде Lerna, которые уменьшают зависимость от внешних пакетов

### 3. Изменения в культуре разработки

- **Критическое отношение к микропакетам**: переосмысление пользы от пакетов из нескольких строк кода
- **Оценка "дерева зависимостей"**: разработчики стали больше внимания уделять количеству зависимостей
- **Дублирование критического кода**: некоторые библиотеки начали включать критические функции внутрь себя
- **Инструменты для анализа зависимостей**: появились инструменты для оценки "здоровья" зависимостей

## Альтернативные решения, появившиеся после инцидента

### Технические решения

1. **Yarn**:

   - Локальное кэширование пакетов
   - Детерминированные установки через yarn.lock
   - Офлайн-режим установки

2. **pnpm**:

   - Эффективное использование дискового пространства через хранилище
   - Более строгая и правильная структура node_modules

3. **npm ci**:
   - Команда для чистой установки в CI-системах
   - Строгое соответствие package-lock.json

### Практики разработки

1. **Вендоринг** критических зависимостей (включение кода в свой репозиторий)
2. **Создание приватных npm-реестров** (Verdaccio, npm Enterprise)
3. **Автоматизированный аудит зависимостей** (npm audit, Snyk)

## Выводы и уроки из инцидента

### 1. Технические уроки

- **Централизованные репозитории создают единую точку отказа**
- **Цепочки зависимостей увеличивают хрупкость системы**
- **Необходимо локальное кэширование пакетов**
- **Lock-файлы критически важны для стабильности сборки**

### 2. Организационные уроки

- **Важность четких политик в открытых реестрах**
- **Баланс между интересами авторов пакетов и пользователей**
- **Необходимость механизмов разрешения конфликтов**

### 3. Философские уроки

- **"Не повторяй себя" (DRY) vs "Не повторяй других" (NIH)**
- **Компромисс между модульностью и автономностью**
- **Ответственность разработчиков перед экосистемой**

## Заключение

Инцидент с left-pad стал поворотным моментом в истории JavaScript-экосистемы. Он привел к переосмыслению принципов управления зависимостями, созданию новых инструментов и практик, а также подчеркнул как силу, так и уязвимость модульного подхода к разработке ПО. Сегодня большинство разработчиков знают об этом инциденте и учитывают его уроки при проектировании своих систем.

---

[[003 JSCore|Назад]]

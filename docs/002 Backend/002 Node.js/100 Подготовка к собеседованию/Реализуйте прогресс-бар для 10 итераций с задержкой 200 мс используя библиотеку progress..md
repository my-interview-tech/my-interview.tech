---
title: Реализуйте прогресс-бар для 10 итераций с задержкой 200 мс используя библиотеку progress
draft: false
tags:
  - "#NodeJS"
  - "#progress"
  - "#CLI"
  - "#npm-пакеты"
  - "#асинхронность"
  - "#терминал"
info:
  - https://www.npmjs.com/package/progress
  - https://github.com/visionmedia/node-progress
---

# Реализация прогресс-бара в Node.js с библиотекой progress

Библиотека [progress](https://www.npmjs.com/package/progress) - это популярный инструмент для создания гибко настраиваемых прогресс-баров в консольных приложениях Node.js. Ниже представлена пошаговая реализация задачи.

## Шаг 1: Установка библиотеки progress

Сначала нужно установить библиотеку через npm:

```bash
npm install progress
```

## Шаг 2: Создание скрипта с прогресс-баром

Создадим файл `progress-bar.js` со следующим содержимым:

```javascript
// Подключаем библиотеку progress
const ProgressBar = require("progress")

// Функция для создания задержки (промис с setTimeout)
function delay(ms) {
  return new Promise((resolve) => setTimeout(resolve, ms))
}

// Асинхронная функция для запуска прогресс-бара
async function runProgressBar() {
  // Создаем новый прогресс-бар
  // :bar - плейсхолдер для самого бара
  // :current - текущее значение
  // :total - общее значение
  // :percent - процент выполнения
  // :elapsed - прошедшее время в секундах
  // :eta - оценка оставшегося времени в секундах
  const bar = new ProgressBar("Прогресс: [:bar] :current/:total :percent :etas", {
    complete: "=", // Символ для заполненной части
    incomplete: " ", // Символ для незаполненной части
    width: 30, // Ширина бара
    total: 10, // Общее количество итераций
    clear: true, // Очищать полосу по завершении
  })

  // Выполняем 10 итераций с задержкой 200 мс
  for (let i = 0; i < 10; i++) {
    // Ждем 200 мс
    await delay(200)

    // Увеличиваем прогресс
    bar.tick()

    // Дополнительно можно передать объект с данными для подстановки в форматную строку
    // bar.tick({ title: `Итерация ${i + 1}` });
  }

  console.log("Выполнение завершено!")
}

// Запускаем прогресс-бар
runProgressBar().catch(console.error)
```

## Шаг 3: Запуск скрипта

Запустим скрипт в терминале:

```bash
node progress-bar.js
```

Результат выполнения будет примерно следующим (обновляется в реальном времени):

```
Прогресс: [==============================] 10/10 100% 0.0s
Выполнение завершено!
```

## Варианты кастомизации

### 1. Передача данных для форматирования

Можно передать объект с данными в метод `tick()` для использования в форматной строке:

```javascript
const bar = new ProgressBar("Загрузка [:bar] :percent - :file", {
  total: files.length,
  width: 40,
})

for (const file of files) {
  await processFile(file)
  bar.tick({ file: file.name })
}
```

### 2. Обновление без увеличения прогресса

Для обновления сообщения без изменения прогресса:

```javascript
bar.tick(0, { status: "Обработка данных..." })
```

### 3. Произвольное увеличение

Для увеличения на определенную величину:

```javascript
// Увеличение на 2 единицы
bar.tick(2)

// Или установка конкретного значения
bar.update(0.5) // 50% прогресса
```

## Альтернативная реализация с колбэками

Для тех, кто предпочитает колбэки вместо async/await:

```javascript
const ProgressBar = require("progress")

// Создаем новый прогресс-бар
const bar = new ProgressBar("Выполнение: [:bar] :percent", {
  total: 10,
  width: 30,
})

// Переменная для отслеживания текущей итерации
let current = 0

// Функция для выполнения следующего шага
function nextStep() {
  // Проверяем, достигли ли мы конца
  if (current >= 10) {
    console.log("Выполнение завершено!")
    return
  }

  // Увеличиваем прогресс
  bar.tick()
  current++

  // Планируем следующий шаг через 200 мс
  setTimeout(nextStep, 200)
}

// Начинаем выполнение
nextStep()
```

## Использование библиотеки progress в реальных проектах

Библиотека progress особенно полезна в следующих сценариях:

1. **CLI-инструменты**: для отображения прогресса длительных операций.
2. **Скрипты миграции данных**: для отслеживания прогресса при переносе большого объема данных.
3. **Процессы сборки**: показ прогресса компиляции, минификации или объединения файлов.
4. **Скрипты загрузки/выгрузки файлов**: для визуализации прогресса загрузки.

## Заключение

Библиотека progress - это простой, но мощный инструмент для создания интерактивных прогресс-баров в консольных приложениях Node.js. Она имеет гибкую настройку внешнего вида и форматирования и может быть легко интегрирована в различные асинхронные операции, чтобы предоставить пользователю визуальный индикатор прогресса длительных процессов.

---

[[003 JSCore|Назад]]

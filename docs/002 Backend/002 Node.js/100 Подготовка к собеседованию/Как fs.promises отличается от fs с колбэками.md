---
title: Как fs.promises отличается от fs с колбэками
draft: true
tags: NodeJS
info:
---
#### 1. **Синтаксис:**

- **`fs.promises`** предоставляет API на основе **промисов** (Promises), что позволяет использовать **async/await** для работы с файлами.
- **`fs` с колбэками** использует традиционный подход с **колбэками**, что может привести к "callback hell" (глубокой вложенности).

#### 2. **Простота использования:**

- **`fs.promises`**:  
    С использованием промисов код становится чище и проще, особенно при работе с несколькими асинхронными операциями.
    
    javascript
    
    КопироватьРедактировать
    
    `const fs = require('fs').promises;  async function readFile() {   try {     const data = await fs.readFile('file.txt', 'utf-8');     console.log(data);   } catch (error) {     console.error(error);   } }  readFile();`
    
- **`fs` с колбэками**:  
    При использовании колбэков для каждой операции необходимо прописывать колбэк-функцию. В случае ошибок можно использовать дополнительные блоки `try/catch`.
    
    javascript
    
    КопироватьРедактировать
    
    `const fs = require('fs');  fs.readFile('file.txt', 'utf-8', (err, data) => {   if (err) {     console.error(err);     return;   }   console.log(data); });`
    

#### 3. **Обработка ошибок:**

- **`fs.promises`**: Ошибки выбрасываются как исключения, которые легко обрабатывать с помощью `try/catch` в асинхронных функциях.
    
    javascript
    
    КопироватьРедактировать
    
    `try {   const data = await fs.readFile('file.txt', 'utf-8'); } catch (error) {   console.error('Error reading file:', error); }`
    
- **`fs` с колбэками**: Ошибки передаются в первый параметр колбэка, и их необходимо проверять внутри колбэка.
    
    javascript
    
    КопироватьРедактировать
    
    `fs.readFile('file.txt', 'utf-8', (err, data) => {   if (err) {     console.error('Error reading file:', err);     return;   }   console.log(data); });`
    

#### 4. **Обработка нескольких операций (особенно в цепочках):**

- **`fs.promises`**: Использование промисов позволяет легко цепочить асинхронные операции, а также обрабатывать их с помощью `async/await`.
    
    javascript
    
    КопироватьРедактировать
    
    `async function readFiles() {   try {     const data1 = await fs.readFile('file1.txt', 'utf-8');     const data2 = await fs.readFile('file2.txt', 'utf-8');     console.log(data1, data2);   } catch (error) {     console.error(error);   } }`
    
- **`fs` с колбэками**: Когда нужно выполнить несколько операций, часто возникает **глубокая вложенность** колбэков.
    
    javascript
    
    КопироватьРедактировать
    
    `fs.readFile('file1.txt', 'utf-8', (err, data1) => {   if (err) {     console.error(err);     return;   }   fs.readFile('file2.txt', 'utf-8', (err, data2) => {     if (err) {       console.error(err);       return;     }     console.log(data1, data2);   }); });`
    

#### 5. **Возвращаемые значения:**

- **`fs.promises`**: Методы возвращают промисы, которые можно обрабатывать через `await` или `.then()`.
    
    javascript
    
    КопироватьРедактировать
    
    `fs.readFile('file.txt', 'utf-8')   .then(data => console.log(data))   .catch(error => console.error(error));`
    
- **`fs` с колбэками**: Методы возвращают **ничего** (или `undefined`), и результат передаётся через колбэк.
    
    javascript
    
    КопироватьРедактировать
    
    `fs.readFile('file.txt', 'utf-8', (err, data) => {   if (err) {     console.error(err);     return;   }   console.log(data); });`
    

---

### **Преимущества `fs.promises` по сравнению с `fs` с колбэками**:

1. **Чистый синтаксис**: Промисы и `async/await` делают код более читаемым и упрощают обработку ошибок.
2. **Цепочка операций**: Легче обрабатывать несколько операций, избегая глубоких вложенных колбэков.
3. **Обработка ошибок**: Обработка ошибок становится проще с использованием `try/catch`, а не проверкой ошибок внутри колбэков.

### **Преимущества `fs` с колбэками**:

4. **Совместимость**: Методы с колбэками доступны с самого начала работы Node.js, и многие старые библиотеки используют этот стиль.
5. **Контроль над выполнением**: В некоторых случаях использование колбэков может дать больше контроля (например, если нужно выполнять операции параллельно).

---

### **Заключение**:

- Если вы работаете с современными версиями Node.js и вам важна читаемость и удобство работы с асинхронными операциями, **`fs.promises`** — это предпочтительный выбор.
- Если вам нужно работать с более старым кодом или специфическими библиотеками, использующими колбэки, тогда вам стоит использовать **`fs` с колбэками**.
---
title: В чем разница между протоколами TCP и UDP Почему DNS-запросы выполняются через UDP
draft: false
tags:
  - "#NodeJS"
  - "#сеть"
  - "#протоколы"
  - "#TCP"
  - "#UDP"
  - "#DNS"
info:
  - "[Документация RFC 793 (TCP)](https://datatracker.ietf.org/doc/html/rfc793)"
  - "[Документация RFC 768 (UDP)](https://datatracker.ietf.org/doc/html/rfc768)"
  - "[DNS и DNS-серверы](https://ru.wikipedia.org/wiki/DNS)"
---

## Протокол TCP (Transmission Control Protocol)

**TCP** - это протокол транспортного уровня, который обеспечивает надежную передачу данных между устройствами в сети. Он гарантирует, что данные будут доставлены без потерь и в том же порядке, в котором они были отправлены.

### Основные характеристики TCP:

- **Ориентация на соединение** - перед передачей данных устанавливается соединение через "трехстороннее рукопожатие" (three-way handshake)
- **Гарантированная доставка** - получатель отправляет подтверждение (ACK) о получении данных
- **Контроль порядка** - пакеты доставляются в том же порядке, в котором были отправлены
- **Контроль потока** - предотвращает перегрузку получателя
- **Контроль перегрузки** - предотвращает перегрузку сети
- **Повторная передача** - потерянные пакеты отправляются повторно

### Пример использования TCP в Node.js:

```javascript
const net = require("net")

// Создание TCP-сервера
const server = net.createServer((socket) => {
  console.log("Клиент подключен")

  socket.on("data", (data) => {
    console.log(`Получены данные: ${data}`)
    socket.write("Данные успешно получены")
  })

  socket.on("end", () => {
    console.log("Клиент отключен")
  })
})

server.listen(3000, () => {
  console.log("TCP-сервер запущен на порту 3000")
})
```

## Протокол UDP (User Datagram Protocol)

**UDP** - это простой протокол транспортного уровня, который не требует установки соединения и не гарантирует доставку данных. Он предлагает быструю передачу данных с минимальными накладными расходами, но без гарантии доставки.

### Основные характеристики UDP:

- **Без установки соединения** - отправка данных без предварительного рукопожатия
- **Без гарантии доставки** - пакеты могут быть потеряны
- **Без сохранения порядка** - пакеты могут прийти в другом порядке
- **Минимальная задержка** - нет повторной передачи и проверки доставки
- **Низкие накладные расходы** - заголовок UDP значительно меньше, чем у TCP
- **Широковещательная передача** - поддерживает отправку данных нескольким получателям одновременно

### Пример использования UDP в Node.js:

```javascript
const dgram = require("dgram")

// Создание UDP-сервера
const server = dgram.createSocket("udp4")

server.on("message", (msg, rinfo) => {
  console.log(`Получено сообщение от ${rinfo.address}:${rinfo.port}: ${msg}`)
})

server.on("listening", () => {
  const address = server.address()
  console.log(`UDP-сервер запущен на ${address.address}:${address.port}`)
})

server.bind(3000)
```

## Сравнение TCP и UDP

| **Характеристика**   | **TCP**                            | **UDP**                          |
| -------------------- | ---------------------------------- | -------------------------------- |
| **Соединение**       | Ориентирован на соединение         | Без соединения                   |
| **Доставка**         | Гарантированная                    | Не гарантированная               |
| **Порядок пакетов**  | Сохраняется                        | Не сохраняется                   |
| **Скорость**         | Медленнее из-за накладных расходов | Быстрее                          |
| **Надежность**       | Высокая                            | Низкая                           |
| **Размер заголовка** | 20-60 байт                         | 8 байт                           |
| **Контроль потока**  | Есть                               | Нет                              |
| **Применение**       | Веб-браузеры, email, FTP           | Стриминг, DNS, VoIP, онлайн-игры |

## Почему DNS-запросы выполняются через UDP

DNS (Domain Name System) в основном использует протокол UDP по нескольким причинам:

1. **Скорость и эффективность** - DNS-запросы обычно маленькие и укладываются в один UDP-пакет, что делает их передачу быстрой и эффективной.

2. **Отсутствие накладных расходов** - UDP не требует установки соединения, что уменьшает задержку при выполнении DNS-запросов.

3. **Достаточная надежность** - DNS-запросы просты и короткие, а потеря пакета не критична, так как клиент может просто повторить запрос.

4. **Масштабируемость** - DNS-серверы обрабатывают огромное количество запросов, и использование UDP позволяет им обслуживать больше клиентов одновременно.

### Пример DNS-запроса через UDP в Node.js:

```javascript
const dns = require("dns")

dns.lookup("example.com", (err, address, family) => {
  if (err) throw err
  console.log(`Адрес: ${address}, тип: IPv${family}`)
})

// Для явного использования UDP можно использовать низкоуровневые библиотеки
// или native DNS resolver
```

Однако стоит отметить, что в некоторых случаях DNS использует TCP:

- Когда размер ответа превышает 512 байт (традиционное ограничение для UDP)
- При передаче зон (zone transfers) между DNS-серверами
- В случае расширенных DNS-запросов (EDNS) с большими ответами

## Заключение

- **TCP** обеспечивает надежную передачу данных и поддерживает порядок пакетов, но с большими накладными расходами. Он идеально подходит для приложений, где важна целостность данных.
- **UDP** предлагает быструю передачу с минимальными накладными расходами, но без гарантий доставки. Он подходит для приложений, где важна скорость и приемлема потеря части данных.
- **DNS** в основном использует UDP для быстрых и эффективных запросов, но может переключаться на TCP при необходимости передачи больших объемов данных.

---

[[002 Node.js|Назад]]

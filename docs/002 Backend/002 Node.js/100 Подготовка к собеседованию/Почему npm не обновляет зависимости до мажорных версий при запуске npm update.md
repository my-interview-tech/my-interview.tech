---
title: Почему npm не обновляет зависимости до мажорных версий при запуске npm update
draft: false
tags:
  - "#NodeJS"
  - "#npm"
  - "#semver"
  - "#зависимости"
  - "#версионирование"
  - "#package.json"
info:
  - "[Документация npm по командам обновления](https://docs.npmjs.com/cli/v8/commands/npm-update)"
  - "[Руководство по семантическому версионированию](https://semver.org/lang/ru/)"
  - "[npm-check-updates](https://www.npmjs.com/package/npm-check-updates)"
---

Команда **`npm update`** не обновляет зависимости до **мажорных версий** по нескольким причинам, связанным с механизмами управления версиями в **npm** и с тем, как указаны версии пакетов в вашем **`package.json`**.

### Причины:

1. **Диапазоны версий в `package.json`**:

   - Когда вы добавляете зависимости в проект с помощью **`npm install <пакет>`**, npm по умолчанию использует семантическое версионирование и записывает диапазон версий в **`package.json`**.
   - **Мажорные обновления** (например, из `1.x.x` в `2.x.x`) могут быть несовместимы с вашим кодом, поэтому npm **ограничивает обновления** в соответствии с диапазоном версий, указанным в **`package.json`**.
     - Если для пакета в **`package.json`** указано, например, `^1.0.0`, это означает, что npm будет обновлять только **минорные** или **патч** версии, но **не мажорные**.
     - Диапазон `^1.0.0` разрешает обновления до любой версии `1.x.x`, но не `2.x.x`, так как это может быть несовместимым с вашим кодом.

2. **Семантическое версионирование (semver)**:

   - В соответствии с **семантическим версионированием** (semver), изменение мажорной версии (например, с `1.x.x` на `2.x.x`) может привести к нарушению совместимости. Поэтому npm **по умолчанию** обновляет пакеты только до последних совместимых версий, указанных в диапазоне.
   - Например, если в **`package.json`** указано `^1.0.0`, npm обновит пакет до версии `1.x.x`, но не до версии `2.x.x`.

3. **Механизм обновлений в `npm update`**:

   - **`npm update`** обновляет зависимости только в пределах разрешённых диапазонов, указанных в **`package.json`**. Это значит, что **мажорные обновления** не будут выполнены, так как они могут нарушить совместимость с существующим кодом.
   - Команда **`npm update`** в основном обновляет только **минорные** и **патч** версии зависимостей.

### Как обновить до мажорной версии?

Если вы хотите обновить зависимость до **мажорной версии**, можно вручную изменить диапазон версий в **`package.json`** или использовать утилиту **`npm-check-updates`**.

#### 1. **Изменить вручную диапазон версий:**

- Откройте **`package.json`** и измените диапазон версий для нужного пакета.
- Например, измените:
  ```json
  "lodash": "^1.0.0"
  ```
  на:
  ```json
  "lodash": "^2.0.0"
  ```
- После этого выполните:
  ```bash
  npm install
  ```

#### 2. **Использование `npm-check-updates` (ncu):**

1. Установите **`npm-check-updates`** (если не установлено):

   ```bash
   npm install -g npm-check-updates
   ```

2. Просмотрите устаревшие пакеты и их последние версии:

   ```bash
   npx npm-check-updates
   ```

3. Обновите все зависимости до последних версий (включая мажорные):

   ```bash
   npx npm-check-updates -u
   ```

4. После этого выполните:

   ```bash
   npm install
   ```

### Заключение:

- **`npm update`** обновляет зависимости в рамках указанных в **`package.json`** диапазонов, что исключает мажорные обновления.
- Чтобы обновить до мажорной версии, вам нужно либо вручную изменить диапазон версий в **`package.json`**, либо использовать утилиту **`npm-check-updates`**.

---

[[002 Node.js|Назад]]

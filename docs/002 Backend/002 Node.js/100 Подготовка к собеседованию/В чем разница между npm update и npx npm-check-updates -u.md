---
title: В чем разница между npm update и npx npm-check-updates -u
draft: false
tags:
  - "#NodeJS"
  - "#npm"
  - "#пакеты"
  - "#JavaScript"
  - "#зависимости"
  - "#npx"
info:
  - "[Документация npm: update](https://docs.npmjs.com/cli/v8/commands/npm-update)"
  - "[npm-check-updates на GitHub](https://github.com/raineorshine/npm-check-updates)"
  - "[Версионирование в npm (semver)](https://docs.npmjs.com/about-semantic-versioning)"
---

# Разница между npm update и npx npm-check-updates -u

Команды `npm update` и `npx npm-check-updates -u` (сокращенно `npx ncu -u`) используются для обновления зависимостей проекта, но имеют фундаментальные различия в подходе и результате.

## 1. npm update

**npm update** обновляет установленные пакеты до последних версий, но строго соблюдает ограничения, указанные в `package.json`.

### Основные характеристики:

- **Соблюдение версионирования**: Обновляет пакеты только в пределах диапазона версий, указанного в `package.json`.
- **Сохранение совместимости**: Не обновляет до мажорных версий (если не указано явно), чтобы избежать потенциальных проблем с совместимостью.
- **Обновление зависимостей**: Обновляет как сами пакеты в `node_modules`, так и версии в `package.json` (в пределах ограничений).
- **Безопасность**: Более консервативный и безопасный подход, минимизирующий риск поломки.

### Пример работы:

Если в `package.json` указано:

```json
"dependencies": {
  "lodash": "^4.17.0"
}
```

После выполнения `npm update`:

- Пакет `lodash` будет обновлен до последней версии в пределах `4.x.x` (например, до `4.17.21`).
- Мажорная версия (`5.x.x`), даже если она существует, не будет установлена.

### Варианты команды:

```bash
# Обновить все пакеты согласно ограничениям в package.json
npm update

# Обновить конкретный пакет
npm update lodash

# Обновить только dev-зависимости
npm update --dev
```

## 2. npx npm-check-updates -u

**npm-check-updates** (ncu) - это сторонний инструмент, который обновляет версии в `package.json` до самых последних, игнорируя указанные ограничения диапазонов версий.

### Основные характеристики:

- **Игнорирование ограничений**: Обновляет версии до самых последних, включая мажорные обновления, игнорируя семантическое версионирование в `package.json`.
- **Двухэтапный процесс**: Сначала обновляет только `package.json`, затем требуется отдельно запустить `npm install` для фактической установки новых версий.
- **Полное обновление**: Позволяет перейти на новейшие версии всех зависимостей, даже если это несовместимые мажорные обновления.
- **Риск**: Более агрессивный подход, который может привести к проблемам совместимости.

### Пример работы:

Если в `package.json` указано:

```json
"dependencies": {
  "lodash": "^4.17.0"
}
```

После выполнения `npx npm-check-updates -u`:

- В `package.json` версия будет обновлена до самой последней, например, `"lodash": "^5.0.0"` (если версия 5 существует).
- Фактическое обновление пакетов не произойдет, пока не будет выполнена команда `npm install`.

### Варианты команды:

```bash
# Проверить, какие обновления доступны (без изменения package.json)
npx npm-check-updates

# Обновить все версии в package.json до последних
npx npm-check-updates -u

# Обновить только определенный пакет
npx npm-check-updates -u lodash

# Обновить только до последней патч-версии
npx npm-check-updates -u --target patch
```

## Сравнение процессов обновления

| **Шаг процесса**              | **npm update**                                    | **npx npm-check-updates -u**                          |
| ----------------------------- | ------------------------------------------------- | ----------------------------------------------------- |
| **1. Анализ**                 | Проверяет доступные версии в пределах ограничений | Проверяет все последние версии, игнорируя ограничения |
| **2. Изменение package.json** | Обновляет версии в пределах ограничений           | Обновляет до самых последних версий                   |
| **3. Установка пакетов**      | Автоматически устанавливает обновленные пакеты    | Требуется запустить `npm install` отдельно            |
| **4. Риск изменений**         | Низкий (соблюдаются семантические ограничения)    | Высокий (возможны несовместимые изменения)            |

## Пример практического использования

### Сценарий 1: Безопасное обновление пакетов

```bash
# Проверка текущих версий
npm list

# Обновление пакетов в рамках указанных ограничений
npm update

# Проверка обновленных версий
npm list
```

### Сценарий 2: Полное обновление до последних версий

```bash
# Проверка доступных обновлений без внесения изменений
npx npm-check-updates

# Обновление версий в package.json до последних
npx npm-check-updates -u

# Установка обновленных пакетов
npm install

# Проверка и тестирование приложения на совместимость
# (важный шаг после мажорных обновлений)
npm test
```

## Когда использовать каждую команду

### Используйте `npm update` когда:

- Вы хотите безопасно обновить пакеты с минимальным риском
- Вы работаете с продакшн-приложением, где стабильность критически важна
- Вы хотите ограничить обновления патчами и минорными версиями
- Вам важно сохранить совместимость с текущим кодом

### Используйте `npx npm-check-updates -u` когда:

- Вы хотите полностью обновить проект до самых последних версий
- Вы готовы к возможным несовместимостям и имеете время для их исправления
- Вы хотите получить доступ к новым функциям в мажорных версиях
- Вы начинаете новый проект и хотите использовать самые свежие версии зависимостей

## Пример расширенного процесса обновления

```bash
# 1. Сохранить текущее состояние для возможности отката
git commit -am "Checkpoint before dependency updates"

# 2. Проверить доступные обновления
npx npm-check-updates

# 3. Обновить только патч и минорные версии
npx npm-check-updates -u --target minor

# 4. Установить обновленные версии
npm install

# 5. Тестирование после минорных обновлений
npm test

# 6. При успешных тестах, проверить мажорные обновления
npx npm-check-updates -u --filter lodash,express --target major

# 7. Установить мажорные обновления выбранных пакетов
npm install

# 8. Тестирование после мажорных обновлений
npm test

# 9. При необходимости откатиться
# git reset --hard HEAD~1
```

## Заключение

- **`npm update`** представляет консервативный подход к обновлению, ограниченный правилами семантического версионирования, и подходит для повседневного обслуживания проекта.

- **`npx npm-check-updates -u`** предлагает более радикальный подход, обновляя зависимости до самых последних версий, что полезно для модернизации проекта, но требует тщательного тестирования на совместимость.

Выбор между этими командами зависит от ваших целей, толерантности к риску и готовности исправлять возможные проблемы совместимости в коде.

---

[[002 Node.js|Назад]]

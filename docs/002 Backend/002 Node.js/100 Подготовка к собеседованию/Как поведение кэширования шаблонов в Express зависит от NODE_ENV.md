---
title: Как поведение кэширования шаблонов в Express зависит от NODE_ENV
draft: true
tags: NodeJS
info:
---
В **Express.js** поведение кэширования шаблонов зависит от значения переменной окружения `NODE_ENV`. Это влияет на то, будет ли кэшироваться скомпилированный шаблон и как часто будет происходить его повторная компиляция.

### 1. **По умолчанию в режиме разработки (NODE_ENV = 'development')**

В **режиме разработки** кэширование **выключено**. Это означает, что каждый раз при рендеринге шаблона он будет компилироваться заново. Такое поведение удобно для разработки, так как позволяет видеть изменения в шаблонах сразу, без необходимости перезапускать сервер.

#### Пример:

js

КопироватьРедактировать

`app.set('view engine', 'ejs'); app.set('views', path.join(__dirname, 'views'));  // В режиме разработки шаблон будет компилироваться заново при каждом запросе app.use((req, res, next) => {   res.render('index', { title: 'My App' }); });`

### 2. **В режиме продакшн (NODE_ENV = 'production')**

В **продакшн-режиме** кэширование включено. Это означает, что Express будет компилировать шаблон один раз при первом запросе, а затем использовать кэшированную версию для всех последующих запросов. Это значительно ускоряет рендеринг, так как не требуется повторная компиляция шаблонов.

#### Пример:

js

КопироватьРедактировать

`app.set('view engine', 'ejs'); app.set('views', path.join(__dirname, 'views'));  // В режиме продакшн шаблон будет кэшироваться, и повторная компиляция не произойдёт app.use((req, res, next) => {   res.render('index', { title: 'My App' }); });`

### 3. **Настройка кэширования вручную**

Можно также вручную настроить кэширование шаблонов, независимо от значения `NODE_ENV`, с помощью опции `view cache` в Express:

- **Включение кэширования**:
    
    js
    
    КопироватьРедактировать
    
    `app.set('view cache', true); // Включает кэширование шаблонов`
    
- **Отключение кэширования**:
    
    js
    
    КопироватьРедактировать
    
    `app.set('view cache', false); // Отключает кэширование шаблонов`
    

#### Пример настройки в зависимости от среды:

js

КопироватьРедактировать

`if (process.env.NODE_ENV === 'production') {   app.set('view cache', true); // В продакшне включаем кэширование } else {   app.set('view cache', false); // В разработке выключаем кэширование }`

### 4. **Поведение в зависимости от шаблонизаторов**

Шаблонизаторы, такие как **EJS**, **Pug**, **Handlebars** и другие, используют эту настройку кэширования по-своему. Например:

- **EJS**: В продакшн-режиме будет использовать кэш компиляции шаблонов.
- **Pug**: Поступает аналогично, компилируя шаблоны один раз в продакшн-режиме и повторно использует кэшированные шаблоны.
- **Handlebars**: Также поддерживает кэширование компиляции шаблонов в продакшн-среде.

### Заключение

- В **режиме разработки** (при `NODE_ENV = 'development'`) кэширование шаблонов **выключено** для обеспечения быстрой реакции на изменения.
- В **режиме продакшн** (при `NODE_ENV = 'production'`) кэширование **включено** для улучшения производительности и ускорения рендеринга шаблонов.
- Настройка кэширования может быть изменена вручную с помощью параметра `view cache`, если необходимо.

Использование кэширования шаблонов в продакшн-среде помогает уменьшить нагрузку на сервер и улучшить скорость отклика за счет предотвращения повторной компиляции шаблонов.
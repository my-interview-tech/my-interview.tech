---
title: Реализуйте обработку ошибки при подключении к несуществующей базе данных.
draft: false
tags:
  - "#NodeJS"
  - "#MySQL"
  - "#обработка-ошибок"
  - "#подключение-к-бд"
  - "#error-handling"
  - "#database"
info:
  - "[Документация по MySQL для Node.js](https://github.com/mysqljs/mysql)"
  - "[Руководство по обработке ошибок в Node.js](https://nodejs.org/en/docs/guides/error-handling/)"
  - "[Коды ошибок MySQL](https://dev.mysql.com/doc/refman/8.0/en/server-error-reference.html)"
---

Если база данных не существует, MySQL вернёт ошибку `ER_BAD_DB_ERROR`. Ниже показан код, который **перехватывает ошибки при подключении** и корректно их обрабатывает.

---

### **1. Код с обработкой ошибок**

```javascript
const mysql = require("mysql")

const pool = mysql.createPool({
  host: "localhost",
  user: "root",
  password: "password",
  database: "non_existent_db", // Несуществующая база данных
  connectionLimit: 10,
})

// Попытка получить соединение
pool.getConnection((err, connection) => {
  if (err) {
    if (err.code === "ER_BAD_DB_ERROR") {
      console.error("Ошибка: База данных не существует.")
    } else if (err.code === "ER_ACCESS_DENIED_ERROR") {
      console.error("Ошибка: Неверные учетные данные.")
    } else {
      console.error("Ошибка подключения к MySQL:", err.message)
    }
    return
  }

  console.log("Подключение успешно установлено")
  connection.release() // Освобождаем соединение
})
```

---

### **2. Описание кода**

- `pool.getConnection()` пытается получить соединение.
- Если база данных не существует, ловим ошибку с кодом **`ER_BAD_DB_ERROR`**.
- Если логин/пароль неверные, ловим **`ER_ACCESS_DENIED_ERROR`**.
- Если соединение успешно, выводим сообщение и освобождаем соединение (`connection.release()`).

---

### **3. Возможные ошибки и их коды**

| Код ошибки                 | Причина                        |
| -------------------------- | ------------------------------ |
| `ER_BAD_DB_ERROR`          | База данных не существует.     |
| `ER_ACCESS_DENIED_ERROR`   | Неправильный логин или пароль. |
| `ECONNREFUSED`             | MySQL-сервер недоступен.       |
| `PROTOCOL_CONNECTION_LOST` | Соединение потеряно.           |

---

### **4. Как проверить работу?**

- Укажите в `database` несуществующую БД и запустите код.
- Если база данных не найдена, в консоли будет:
  ```
  Ошибка: База данных не существует.
  ```

---

[[002 Node.js|Назад]]

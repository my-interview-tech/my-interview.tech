---
title: Что такое node_modules и зачем она нужна
draft: false
tags:
  - "#NodeJS"
  - "#npm"
  - "#зависимости"
  - "#пакеты"
  - "#структура-проекта"
  - "#модули"
info:
  - https://nodejs.org/api/modules.html#loading-from-node_modules-folders
  - https://docs.npmjs.com/cli/v8/configuring-npm/folders
  - https://habr.com/ru/articles/580062/
---

# Что такое node_modules и зачем она нужна

`node_modules` — это директория, которая создаётся в проекте Node.js при установке зависимостей с помощью npm или yarn. В ней хранятся все пакеты (библиотеки, фреймворки и инструменты), которые требуются для разработки и работы проекта.

## Функции и назначение node_modules

### 1. Хранение зависимостей проекта

`node_modules` содержит:

- Все зависимости из разделов `dependencies` и `devDependencies` в файле package.json
- Зависимости зависимостей (транзитивные зависимости)
- Исполняемые файлы пакетов (бинарники)

### 2. Алгоритм поиска модулей

Когда вы используете `require()` или `import` в коде, Node.js ищет модули по определённому алгоритму:

1. Проверяет, является ли запрашиваемый модуль встроенным (например, `fs`, `http`)
2. Если имя модуля начинается с `./`, `../` или `/`, ищет файл или директорию по указанному пути
3. В противном случае, ищет модуль в папке `node_modules` текущего каталога
4. Если модуль не найден, поднимается на уровень выше и ищет в `../node_modules`
5. Продолжает подниматься, пока не достигнет корня файловой системы

```javascript
// Поиск начнется в ./node_modules/express
const express = require("express")

// Поиск по относительному пути
const myUtils = require("./utils")
```

### 3. Изоляция зависимостей

Каждый проект имеет свою собственную папку `node_modules`, что обеспечивает:

- Независимость проектов друг от друга
- Возможность использовать разные версии одной библиотеки в разных проектах
- Предотвращение конфликтов версий

## Структура директории node_modules

### Простой пример

После установки нескольких пакетов структура `node_modules` может выглядеть так:

```
node_modules/
├── express/             # Основной пакет
│   ├── node_modules/    # Вложенные зависимости express
│   ├── package.json
│   └── ...
├── lodash/              # Утилитарная библиотека
│   ├── package.json
│   └── ...
├── .bin/                # Исполняемые файлы пакетов
│   ├── nodemon -> ../nodemon/bin/nodemon.js
│   └── ...
└── ...
```

### Flat Dependencies (npm 3+)

Современные версии npm "поднимают" зависимости на верхний уровень, чтобы избежать дублирования:

```
node_modules/
├── express/
├── body-parser/         # Зависимость express
├── cors/                # Зависимость express
├── lodash/
└── ...
```

## Важные аспекты использования node_modules

### 1. Исключение из системы контроля версий

`node_modules` **не следует** добавлять в Git или другие системы контроля версий:

```
# .gitignore
node_modules/
```

Причины:

- Занимает огромный объем (иногда гигабайты)
- Легко восстанавливается через `npm install`
- Может содержать скомпилированный под конкретную ОС код

### 2. Управление зависимостями

Правильный способ управления зависимостями — через `package.json`:

```json
{
  "name": "my-project",
  "version": "1.0.0",
  "dependencies": {
    "express": "^4.17.1",
    "lodash": "^4.17.21"
  },
  "devDependencies": {
    "nodemon": "^2.0.15",
    "jest": "^27.5.1"
  }
}
```

### 3. Пакетные менеджеры и node_modules

Разные пакетные менеджеры работают с `node_modules` по-разному:

| Менеджер | Особенности работы с node_modules                                             |
| -------- | ----------------------------------------------------------------------------- |
| npm      | Плоская структура с редко вложенными зависимостями, создаёт package-lock.json |
| yarn     | Плоская структура, создаёт yarn.lock, быстрая установка                       |
| pnpm     | Использует символические ссылки, экономит дисковое пространство               |

## Проблемы и решения

### 1. Проблема "node_modules hell"

Папка `node_modules` может стать очень большой из-за:

- Большого количества зависимостей
- Дублирования пакетов из-за несовместимости версий
- Зависимостей, которые сами имеют много зависимостей

### 2. Решения

```bash
# Анализ размера node_modules
npm install -g npkill
npkill

# Очистка ненужных пакетов
npm prune

# Отображение дерева зависимостей
npm list --depth=1
```

### 3. Локальные и глобальные node_modules

```bash
# Локальная установка (в текущий проект)
npm install lodash  # Устанавливает в ./node_modules

# Глобальная установка (для всей системы)
npm install -g nodemon  # Устанавливает в глобальную node_modules
```

Глобальная директория `node_modules` обычно находится:

- В Windows: `%AppData%\npm\node_modules`
- В macOS/Linux: `/usr/local/lib/node_modules` или `~/.nvm/versions/node/[version]/lib/node_modules`

## Заключение

Директория `node_modules` — это ключевой элемент экосистемы Node.js, обеспечивающий:

- Организованное хранение зависимостей
- Изоляцию проектов друг от друга
- Эффективный механизм загрузки модулей

Хотя `node_modules` может создавать определённые проблемы (большой размер, сложная структура), она является фундаментальной частью Node.js, делающей возможной модульную разработку и повторное использование кода.

---

[[003 JSCore|Назад]]

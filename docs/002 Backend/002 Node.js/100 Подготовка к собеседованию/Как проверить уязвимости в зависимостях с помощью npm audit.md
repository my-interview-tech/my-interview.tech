---
title: Как проверить уязвимости в зависимостях с помощью npm audit
draft: false
tags:
  - "#NodeJS"
  - "#npm"
  - "#безопасность"
  - "#уязвимости"
  - "#audit"
  - "#DevOps"
info:
  - "[Официальная документация npm audit](https://docs.npmjs.com/cli/v8/commands/npm-audit)"
  - "[Руководство по безопасности на npmjs.com](https://docs.npmjs.com/auditing-package-dependencies-for-security-vulnerabilities)"
  - "[Блог npm о безопасности](https://github.blog/2021-02-02-npm-security-overview/)"
---

**npm audit** — это встроенный инструмент безопасности в npm, который автоматически проверяет зависимости проекта на наличие известных уязвимостей. Команда анализирует файл `package-lock.json` (или `npm-shrinkwrap.json`) и сопоставляет установленные версии пакетов с базой данных известных уязвимостей.

## Основные возможности npm audit

### 1. Обнаружение уязвимостей

`npm audit` сканирует ваш проект и выявляет зависимости с известными уязвимостями, предоставляя:

- Подробные описания обнаруженных проблем
- Оценку серьезности (низкая, средняя, высокая, критическая)
- Затронутые версии пакетов
- Пути зависимостей, которые привели к уязвимым пакетам

### 2. Автоматическое исправление уязвимостей

Команда `npm audit fix` может автоматически обновить уязвимые зависимости до безопасных версий, сохраняя совместимость с требованиями, указанными в `package.json`.

### 3. Интеграция в рабочий процесс

`npm audit` автоматически запускается при выполнении `npm install`, если не указан флаг `--no-audit`, что обеспечивает постоянный контроль безопасности в процессе разработки.

## Использование npm audit

### Базовая проверка

Чтобы просканировать проект на уязвимости, выполните:

```bash
npm audit
```

Пример вывода:

```
# npm audit report

lodash  <4.17.19
Severity: high
Prototype Pollution in lodash - https://github.com/advisories/GHSA-p6mc-m468-83gw
fix available via `npm audit fix`
node_modules/lodash

1 high severity vulnerability

To address all issues, run:
  npm audit fix
```

### Автоматическое исправление

Для автоматического обновления уязвимых зависимостей:

```bash
npm audit fix
```

Эта команда обновит все уязвимые зависимости до безопасных версий, сохраняя совместимость с диапазонами версий, указанными в `package.json`.

### Форматы вывода

Для получения результатов в формате JSON (полезно для интеграции с CI/CD):

```bash
npm audit --json > security-report.json
```

Для краткого вывода:

```bash
npm audit --summary
```

## Дополнительные опции

### Только для production-зависимостей

Сканирование только production-зависимостей (без devDependencies):

```bash
npm audit --production
```

Исправление только production-зависимостей:

```bash
npm audit fix --only=prod
```

### Принудительное обновление major-версий

Для обновления до безопасных версий даже с нарушением совместимости:

```bash
npm audit fix --force
```

> **Важно**: Использование `--force` может привести к нарушению работы приложения, так как будут установлены новые мажорные версии пакетов, которые могут содержать несовместимые изменения API.

### Уровень детализации

Фильтрация результатов по уровню серьезности:

```bash
npm audit --audit-level=high
```

Возможные значения: `low`, `moderate`, `high`, `critical`

## Интеграция с CI/CD

npm audit можно интегрировать в пайплайны CI/CD, чтобы блокировать сборки с уязвимостями:

```bash
# В pipeline CI
npm audit --audit-level=high --production

# Ненулевой код возврата означает наличие уязвимостей указанного уровня и выше
if [ $? -ne 0 ]; then
  echo "Обнаружены критические уязвимости в зависимостях!"
  exit 1
fi
```

Для проектов с большим количеством зависимостей полезно создать отдельную задачу для аудита безопасности:

```json
// В package.json
"scripts": {
  "test": "jest",
  "security-audit": "npm audit --production --audit-level=high"
}
```

## Ограничения npm audit

1. **Охват**: npm audit проверяет только известные уязвимости, зарегистрированные в базе данных npm.
2. **Ложные срабатывания**: некоторые уязвимости могут не применяться к вашему использованию библиотеки.
3. **Транзитивные зависимости**: иногда сложно обновить глубоко вложенные зависимости.

## Альтернативные инструменты

Помимо npm audit, существуют другие инструменты для проверки безопасности зависимостей:

1. **Snyk** — более полный анализ с интеграцией в GitHub и другие платформы
2. **OWASP Dependency-Check** — инструмент для проверки зависимостей на известные уязвимости
3. **SonarQube** — комплексный анализ кода с проверкой зависимостей

## Лучшие практики

1. **Регулярный аудит**: включите `npm audit` в процесс CI/CD
2. **Автоматизация**: настройте автоматические PR с исправлениями через Dependabot или Renovate
3. **Ведение журнала**: документируйте обнаруженные уязвимости и примененные исправления
4. **Обновляйте пакеты**: регулярно обновляйте зависимости для минимизации поверхности атаки

Команда npm audit является мощным инструментом для поддержания безопасности проекта, особенно в сочетании с другими практиками безопасной разработки.

---

[[003 JSCore|Назад]]

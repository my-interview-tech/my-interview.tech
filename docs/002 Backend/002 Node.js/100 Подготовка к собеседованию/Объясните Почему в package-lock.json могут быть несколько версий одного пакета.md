---
title: Объясните Почему в package-lock.json могут быть несколько версий одного пакета
draft: false
tags:
  - "#NodeJS"
  - "#NPM"
  - "#package-lock"
  - "#зависимости"
  - "#semver"
info:
  - "[Документация npm о package-lock.json](https://docs.npmjs.com/cli/v8/configuring-npm/package-lock-json)"
  - "[Семантическое версионирование](https://semver.org/lang/ru/)"
  - "[Решение конфликтов зависимостей](https://docs.npmjs.com/cli/v8/using-npm/dependency-resolution)"
---

В **`package-lock.json`** могут быть несколько версий одного пакета по следующим причинам:

### 1. **Разные версии зависимостей у разных пакетов**

Когда у проекта несколько зависимостей, каждая из которых может требовать разные версии одного и того же пакета, **npm** устанавливает их все. Это особенно актуально для пакетов, которые зависят от других пакетов с различными версиями.

Например:

- Пакет **A** может требовать версию **`lodash@4.17.0`**.
- Пакет **B** может требовать **`lodash@4.19.0`**.

В **`package-lock.json`** будут обе версии **`lodash`**, потому что каждый пакет использует свою версию, и **npm** установит обе.

### 2. **Семантическое версионирование (Semver)**

Когда пакеты в **`package.json`** или **`package-lock.json`** используют диапазоны версий, например:

```json
"dependencies": {
  "lodash": "^4.0.0"
}
```

Это означает, что можно установить любую версию **`lodash`** начиная с **4.0.0**, но меньше **5.0.0**. Если один пакет установит **`lodash@4.17.0`**, а другой **`lodash@4.19.0`**, это приведет к нескольким версиям одного и того же пакета в **`node_modules`**.

**npm** использует дерево зависимостей и может установить несколько версий, если они не совместимы друг с другом, даже если это одна и та же библиотека.

### 3. **Использование транзитивных зависимостей**

Зависимости пакетов могут иметь свои собственные зависимости. Если транзитивные зависимости имеют разные версии одного и того же пакета, **npm** установит все эти версии, чтобы удовлетворить требования всех зависимостей.

Пример:

- Пакет **A** зависит от **B@1.0.0**.
- Пакет **B** зависит от **C@2.0.0**.
- Пакет **C** зависит от **D@1.0.0**.

Если пакеты, использующие **B**, требуют разные версии **D**, **npm** установит их по отдельности.

### 4. **Отсутствие явного указания на необходимость одной версии**

Если в **`package.json`** не указано явно, что необходимо использовать одну и ту же версию для всех зависимостей, **npm** может установить несколько разных версий, если они удовлетворяют зависимости, но не обязательно идентичны.

### 5. **Устаревшие зависимости**

Когда один пакет в вашем проекте использует более старую или несовместимую версию зависимости, а другой — более новую, это также может привести к установке нескольких версий одного пакета, особенно если эти пакеты не обновлялись вместе.

### Пример **`package-lock.json`** с несколькими версиями:

```json
{
  "dependencies": {
    "lodash": {
      "version": "4.17.0",
      "resolved": "https://registry.npmjs.org/lodash/-/lodash-4.17.0.tgz",
      "integrity": "sha512-rPnn62heICBVRP02OoT70LBJv5FsP6+dXXxuBbyw2Xj8hTyycJpTdw6UMTg5F51cM6KfMpy7UNJ4XxNtzB6Xg==",
      "dev": false
    },
    "lodash": {
      "version": "4.19.0",
      "resolved": "https://registry.npmjs.org/lodash/-/lodash-4.19.0.tgz",
      "integrity": "sha512-xmFcPDRFbeVKnt1kIkkS3l3PvzPfrLzWGbAt2mtaX7m+H/VqF0tkXvERFhzXt31LUFdt3N2wXYeU5mI0Gl4Fw==",
      "dev": false
    }
  }
}
```

### Как npm решает, какие версии установить:

- **npm** при установке зависимостей проверяет дерево зависимостей и устанавливает минимально необходимую версию для каждого пакета.
- Если несколько пакетов требуют разные версии одного и того же пакета, то **npm** установит все эти версии, если они не могут быть объединены в одну версию.

### Заключение:

Несколько версий одного и того же пакета в **`package-lock.json`** могут появиться из-за разных версий, требуемых зависимостями, а также из-за использования разных версий одного пакета в транзитивных зависимостях. Это поведение гарантирует, что все зависимости, требуемые вашим проектом, будут установлены и работать корректно.

---

[[002 Node.js|Назад]]

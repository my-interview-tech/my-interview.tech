---
title: Как браузер определяет IP-адрес домена Как работает кэширование DNS
draft: false
tags:
  - "#NodeJS"
  - "#DNS"
  - "#network"
  - "#browser"
  - "#caching"
  - "#performance"
info:
  - https://developer.mozilla.org/en-US/docs/Glossary/DNS
  - https://www.cloudflare.com/learning/dns/what-is-dns/
---

Когда браузер пытается установить соединение с сервером, он должен сначала узнать IP-адрес для доменного имени, указанного в URL (например, `www.example.com`). Этот процесс называется **разрешением доменного имени**, и его выполняет система **DNS (Domain Name System)**.

### Процесс определения IP-адреса

1. **DNS-запрос:** Когда пользователь вводит в браузере URL, например, `http://www.example.com`, браузер не может сразу подключиться к серверу по доменному имени. Он отправляет запрос DNS-серверу для получения соответствующего **IP-адреса**. Это может происходить через несколько этапов:

   - Браузер проверяет локальный кеш DNS. Если доменное имя уже разрешалось ранее, и его IP-адрес хранится в кеше, браузер использует его без дополнительных запросов.
   - Если записи нет в кеше браузера, запрос отправляется на **DNS-сервер операционной системы**, который проверяет свой кеш.
   - Если адреса нет и на локальном DNS-сервере, запрос может быть передан на другие DNS-серверы (например, на серверы интернет-провайдера или на публичные DNS-серверы, такие как Google DNS или Cloudflare).
   - DNS-серверы могут запросить у других серверов (рекурсивный запрос), пока не найдут нужный IP-адрес.

2. **Ответ DNS-сервера:** После того как DNS-сервер находит нужный IP-адрес, он отправляет его обратно в браузер. Теперь браузер может использовать этот IP-адрес для установления TCP-соединения с сервером.
3. **Установление соединения:** Браузер использует полученный IP-адрес для установления TCP-соединения с сервером и отправки HTTP-запроса.

### Как работает кэширование DNS

Кэширование DNS — это процесс хранения результатов разрешения доменных имен на разных уровнях системы, чтобы ускорить последующие запросы и снизить нагрузку на DNS-серверы.

1. **Кэширование в браузере:** Когда браузер разрешает доменное имя в IP-адрес, он сохраняет его в своем **локальном DNS-кеше**. Это ускоряет повторное разрешение домена. Время, в течение которого запись хранится в кеше, называется **временем жизни (TTL, Time-to-Live)**, и оно указывается в ответе от DNS-сервера.

   - Например, если TTL для домена `www.example.com` составляет 300 секунд, браузер будет хранить его IP-адрес в кеше в течение 5 минут. После этого браузер снова будет делать DNS-запрос, если потребуется.

2. **Кэширование в операционной системе:** Операционная система также имеет свой кеш DNS. После того как браузер отправляет запрос, операционная система может сохранить IP-адрес в своей памяти. Это также помогает ускорить процесс разрешения доменов и уменьшить количество запросов к внешним DNS-серверам.
3. **Кэширование на DNS-сервере:** DNS-серверы также кэшируют результаты запросов. Когда один из пользователей запрашивает IP-адрес для домена, сервер сохраняет этот результат в своем кеше на некоторое время, определяемое TTL. Это позволяет сэкономить время и ресурсы при обслуживании дальнейших запросов от других пользователей.

   - Например, если на DNS-сервер поступает запрос для домена, и TTL для этого домена составляет 24 часа, сервер будет возвращать тот же IP-адрес всем клиентам в течение 24 часов, пока не истечет TTL.

4. **Обновление кэша:** Кэширование DNS помогает улучшить производительность, но существует риск того, что в кеше может храниться устаревшая информация (например, если IP-адрес сервера изменится). Когда TTL истекает, кеш обновляется, и система снова делает запрос к авторитетному DNS-серверу, чтобы получить актуальную информацию.
5. **Решение проблем с кэшированием:** Если вы столкнулись с проблемой, когда DNS-кэш не обновляется или устаревшая информация продолжает использоваться (например, если изменился IP-адрес сервера, но старый адрес остается в кеше), можно выполнить следующие действия:

   - Очистить DNS-кэш на уровне браузера или операционной системы.
   - Использовать инструмент **`nslookup`** или **`dig`** для проверки актуальности DNS-записей.

### Пример проверки DNS с помощью утилит

```bash
# Проверка DNS-записи с помощью nslookup
nslookup example.com

# Проверка DNS-записи с помощью dig (более подробная информация)
dig example.com

# Очистка DNS-кеша в macOS
sudo dscacheutil -flushcache; sudo killall -HUP mDNSResponder

# Очистка DNS-кеша в Windows
ipconfig /flushdns
```

### Подытожим:

- **DNS** преобразует доменные имена в IP-адреса, что позволяет браузеру установить соединение с сервером.
- **Кэширование DNS** помогает ускорить процесс разрешения имен, сохраняя информацию в разных местах (в браузере, операционной системе и на DNS-серверах).
- **TTL** (время жизни) управляет тем, как долго DNS-запись остается в кеше, и когда она должна быть обновлена.

---

[[002 Node.js|Назад]]

---
title: В чем разница между SIGTERM и SIGKILL
draft: false
tags:
  - "#NodeJS"
  - "#процессы"
  - "#сигналы"
  - "#POSIX"
  - "#системное-программирование"
info:
  - "[Документация Node.js по обработке сигналов](https://nodejs.org/api/process.html#signal-events)"
  - "[Руководство по POSIX-сигналам](https://www.gnu.org/software/libc/manual/html_node/Signal-Handling.html)"
  - "[Управление процессами в Node.js](https://nodejs.org/api/process.html#process-events)"
---

# Разница между SIGTERM и SIGKILL

SIGTERM и SIGKILL — это сигналы операционной системы UNIX/Linux, которые используются для завершения процессов. Они принципиально отличаются по способу обработки и влиянию на процесс.

## SIGTERM (Terminate)

**SIGTERM** — это сигнал для "вежливого" запроса процессу завершить свою работу.

### Основные характеристики:

- **Номер сигнала**: 15
- **Обработка**: Может быть перехвачен и обработан процессом
- **Поведение по умолчанию**: Завершение процесса, если обработчик не установлен
- **Назначение**: Корректное завершение с возможностью очистки ресурсов

### Как работает:

1. Сигнал отправляется процессу
2. Процесс может перехватить сигнал и выполнить необходимые действия:
   - Завершить текущие операции
   - Сохранить данные
   - Освободить ресурсы
   - Закрыть соединения
3. После завершения очистки процесс сам завершает своё выполнение

### Пример использования в Node.js:

```javascript
process.on("SIGTERM", () => {
  console.log("Получен сигнал SIGTERM. Завершаем приложение...")

  // Очистка ресурсов
  db.close()
  server.close(() => {
    console.log("Соединения закрыты")
    process.exit(0) // Корректное завершение с кодом 0
  })
})
```

## SIGKILL (Kill)

**SIGKILL** — это сигнал для немедленного и принудительного завершения процесса без возможности обработки.

### Основные характеристики:

- **Номер сигнала**: 9
- **Обработка**: Не может быть перехвачен или проигнорирован
- **Поведение**: Процесс принудительно завершается операционной системой
- **Назначение**: Гарантированное завершение "зависших" процессов

### Как работает:

1. Сигнал отправляется процессу
2. Ядро операционной системы немедленно прекращает выполнение процесса
3. Процесс не получает возможности выполнить какой-либо код
4. Операционная система освобождает все ресурсы, выделенные процессу

### Важные особенности:

- Процесс **не может перехватить** SIGKILL через `process.on('SIGKILL', ...)` в Node.js
- Может привести к потере данных и утечке ресурсов
- Используется как "последнее средство", когда процесс не отвечает на SIGTERM

## Сравнительная таблица

| **Характеристика**        | **SIGTERM (15)**                         | **SIGKILL (9)**                               |
| ------------------------- | ---------------------------------------- | --------------------------------------------- |
| **Может быть перехвачен** | Да                                       | Нет                                           |
| **Можно игнорировать**    | Да                                       | Нет                                           |
| **Очистка ресурсов**      | Возможна (процесс может выполнить код)   | Невозможна (процесс завершается немедленно)   |
| **Скорость завершения**   | Зависит от кода обработчика              | Мгновенная                                    |
| **Риск потери данных**    | Низкий (при правильной обработке)        | Высокий                                       |
| **Используется для**      | Штатного завершения процессов            | Принудительного завершения зависших процессов |
| **Отправка в терминале**  | `kill -15 [PID]` или просто `kill [PID]` | `kill -9 [PID]`                               |

## Практическое применение

### Правильная последовательность завершения процесса:

1. Сначала отправить **SIGTERM** для корректного завершения:

   ```bash
   kill -15 1234   # или просто kill 1234
   ```

2. Если процесс не завершается за разумное время, отправить **SIGKILL**:
   ```bash
   kill -9 1234
   ```

### Пример обработки в Node.js:

```javascript
// Для серверного приложения
const server = http.createServer()

// Корректная обработка SIGTERM
process.on("SIGTERM", () => {
  console.log("Получен SIGTERM. Завершаем работу...")

  server.close(() => {
    console.log("HTTP-сервер закрыт")
    // Закрываем соединения с БД и т.д.
    process.exit(0)
  })

  // Установка таймаута на случай зависания
  setTimeout(() => {
    console.error("Не удалось завершить работу плавно, завершаемся принудительно")
    process.exit(1)
  }, 5000)
})
```

## Рекомендации по использованию

- **Всегда начинайте с SIGTERM** для корректного завершения процесса
- **Используйте SIGKILL только как последнее средство**, когда процесс не реагирует на SIGTERM
- **В Node.js приложениях**, обрабатывайте SIGTERM для корректного закрытия соединений, освобождения ресурсов и сохранения состояния
- **Установите таймаут** в обработчике SIGTERM, чтобы гарантировать завершение процесса даже при зависании

---

[[002 Node.js|Назад]]

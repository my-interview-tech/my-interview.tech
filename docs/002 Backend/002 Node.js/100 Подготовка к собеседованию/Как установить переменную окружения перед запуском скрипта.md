---
title: Как установить переменную окружения перед запуском скрипта
draft: false
tags:
  - "#NodeJS"
  - "#переменные-окружения"
  - "#package.json"
  - "#scripts"
  - "#конфигурация"
info:
  - "[Документация npm scripts](https://docs.npmjs.com/cli/v9/using-npm/scripts)"
  - "[Документация dotenv](https://www.npmjs.com/package/dotenv)"
  - "[Node.js процесс и переменные окружения](https://nodejs.org/api/process.html#processenv)"
---

## Установка переменных окружения в package.json

Самый простой способ установить переменную окружения перед запуском скрипта — это добавить её в команду в разделе `scripts` файла `package.json`:

```json
{
  "scripts": {
    "start": "NODE_ENV=production node app.js",
    "dev": "NODE_ENV=development nodemon app.js",
    "debug": "DEBUG=app:* node app.js"
  }
}
```

## Различия между операционными системами

### Unix-подобные системы (Linux, macOS)

В Unix-подобных системах переменные окружения устанавливаются через знак равенства:

```json
{
  "scripts": {
    "start": "NODE_ENV=production PORT=3000 node app.js"
  }
}
```

### Windows

В Windows синтаксис отличается:

```json
{
  "scripts": {
    "start-win": "set NODE_ENV=production && node app.js"
  }
}
```

## Кросс-платформенное решение

Для кросс-платформенных проектов можно использовать пакет `cross-env`:

```bash
npm install cross-env --save-dev
```

Затем в `package.json`:

```json
{
  "scripts": {
    "start": "cross-env NODE_ENV=production PORT=3000 node app.js"
  }
}
```

## Использование .env файлов

Популярный подход — использовать файл `.env` с пакетом `dotenv`:

1. Установите пакет:

```bash
npm install dotenv --save
```

2. Создайте файл `.env` в корне проекта:

```
NODE_ENV=production
PORT=3000
DATABASE_URL=mongodb://localhost:27017/myapp
```

3. В начале вашего приложения импортируйте и настройте dotenv:

```javascript
require("dotenv").config()
// Или с ES модулями
// import 'dotenv/config';

console.log(process.env.NODE_ENV) // 'production'
```

## Установка нескольких переменных одновременно

Можно устанавливать несколько переменных в одной команде:

```json
{
  "scripts": {
    "start": "NODE_ENV=production PORT=3000 DEBUG=app:* node app.js"
  }
}
```

## Установка переменных в командной строке

Можно также установить переменные напрямую при запуске npm-скрипта:

```bash
NODE_ENV=production npm run start
```

## Передача переменных через аргументы

Другой подход — передача через аргументы и их обработка в скрипте:

```json
{
  "scripts": {
    "start": "node app.js --env production"
  }
}
```

## Использование .npmrc

Можно также настроить `.npmrc` файл для установки переменных окружения:

```
; .npmrc
env.NODE_ENV = production
```

---

[[002 Node.js|Назад]]

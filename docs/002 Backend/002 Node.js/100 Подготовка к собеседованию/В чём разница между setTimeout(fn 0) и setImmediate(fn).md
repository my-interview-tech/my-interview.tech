---
title: В чём разница между setTimeout(fn 0) и setImmediate(fn)?
draft: false
tags:
  - NodeJS
  - setTimeout
  - setImmediate
  - EventLoop
info:
---

Обе функции используются для **отложенного выполнения кода**, но работают по-разному из-за особенностей **event loop** в Node.js.

##### **`setTimeout(fn, 0)`**

Добавляет функцию `fn` в **таймерную очередь (Timers Queue)** и выполняет её **минимум через 1 мс**.

```js
setTimeout(() => console.log('setTimeout'), 0);
```

**Важно:** `setTimeout(fn, 0)` не выполняется сразу, а ждет завершения текущего кода и других задач event loop.

##### **`setImmediate(fn)`**

Добавляет `fn` в **очередь `check`** и выполняет **сразу после I/O операций** (но перед `setTimeout`).

```js
setImmediate(() => console.log('setImmediate'));
```

**Важно:** если вызвать `setImmediate()` в основном потоке, он **обычно** выполняется **раньше `setTimeout(fn, 0)`**.

##### **Разница в приоритете выполнения**

```js
const fs = require('fs');  

fs.readFile(__filename, () => {   
	setTimeout(() => console.log('setTimeout'), 0);   
	setImmediate(() => console.log('setImmediate')); 
});`
```

##### **Вывод:**

```js
setImmediate setTimeout`
```

После завершения I/O (`fs.readFile`) **сначала выполняется `setImmediate()`**, а уже потом `setTimeout()`.

|                      | **setTimeout(fn, 0)**                                             | **setImmediate(fn)**                                  |
| -------------------- | ----------------------------------------------------------------- | ----------------------------------------------------- |
| **Где выполняется**  | В **таймерной** очереди                                           | В **check** очереди                                   |
| **Когда вызывается** | После **минимальной задержки** (обычно 1 мс)                      | **Сразу после I/O операций**                          |
| **Что быстрее?**     | Может быть медленнее, если в таймерной очереди есть другие задачи | Обычно выполняется **раньше**, если вызван внутри I/O |

**Когда использовать?**  

`setTimeout(fn, 0)` – если нужно просто отложить выполнение.  
`setImmediate(fn)` – если код должен выполняться **сразу после I/O операций**.

**Итог:** `setImmediate()` обычно выполняется **раньше**, но точный порядок зависит от контекста в event loop.
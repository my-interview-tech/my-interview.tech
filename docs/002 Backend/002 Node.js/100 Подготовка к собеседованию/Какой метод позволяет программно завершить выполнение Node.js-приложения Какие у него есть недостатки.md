---
title: Какой метод позволяет программно завершить выполнение Node.js-приложения и какие у него есть недостатки
draft: false
tags:
  - "#NodeJS"
  - "#process"
  - "#завершение-работы"
  - "#process.exit"
  - "#асинхронность"
info:
  - "[Документация Node.js по process.exit()](https://nodejs.org/api/process.html#process_process_exit_code)"
  - "[Правильное завершение работы Node.js приложений](https://blog.heroku.com/best-practices-nodejs-errors)"
  - "[Обработка остановки процесса в Node.js](https://nodejs.org/api/process.html#process_signal_events)"
---

Метод, который позволяет программно завершить выполнение Node.js-приложения — это **`process.exit()`**. Этот метод немедленно завершает процесс Node.js с указанным кодом выхода.

### Синтаксис:

```javascript
process.exit([код_выхода])
```

- **`код_выхода`** (необязательный параметр) — это целое число, которое определяет код завершения. По умолчанию используется код `0`, что обозначает нормальное завершение. Ненулевой код (например, `1`) обычно указывает на ошибку.

### Пример:

```javascript
console.log("Приложение завершится через 3 секунды")
setTimeout(() => {
  console.log("Завершаем процесс")
  process.exit(0) // Завершаем приложение с кодом 0 (нормальное завершение)
}, 3000)
```

### Недостатки использования `process.exit()`:

1. **Незавершённые асинхронные операции**: Когда вызывается **`process.exit()`**, Node.js немедленно завершает процесс, не дождавшись завершения асинхронных операций (например, открытых файловых потоков, сетевых запросов, работы с базой данных). Это может привести к тому, что какие-то операции останутся не завершёнными или ресурсы не будут корректно освобождены.

   **Пример проблемы**: Если у вас есть открытые соединения с базой данных, то при вызове `process.exit()` соединения могут быть не закрыты, что приведет к утечкам ресурсов.

2. **Невозможность обработки ошибок или выполнения финальных шагов**: Если приложение должно выполнить финальную обработку (например, закрыть соединения, выполнить запись в лог или завершить другие важные задачи), вызов `process.exit()` может обрезать эти шаги. Он завершит процесс сразу, не дождавшись выполнения асинхронных операций.
3. **Отсутствие возможности корректного завершения**: Если приложение зависает или в процессе его работы происходит исключение, использование `process.exit()` не даёт возможности для корректного завершения работы — например, обработать ошибки или вывести предупреждения.
4. **Необработанные исключения**: Если в приложении происходят необработанные ошибки, использование `process.exit()` может привести к неожиданному завершению без логирования ошибки или сохранения состояния.
5. **Завершение без ожидания сигналов**: В отличие от того, когда Node.js завершает приложение по сигналу операционной системы (например, `SIGINT` или `SIGTERM`), `process.exit()` сразу завершает приложение, игнорируя любые стандартные процедуры завершения, такие как обработка сигналов или асинхронные завершения.

### Рекомендации:

- **Не использовать `process.exit()` без предварительного завершения всех важных операций**, таких как закрытие сетевых соединений или сохранение данных.
- Вместо немедленного завершения приложения, если необходимо выполнить финальную обработку, рассмотрите возможность использования **сигналов** (например, `SIGINT` и `SIGTERM`) или событийных обработчиков для правильного завершения всех операций.
- Если необходимо завершить приложение после завершения всех задач, стоит использовать **`setImmediate()`** или **`process.nextTick()`**, чтобы гарантировать выполнение завершающих операций.

### Вариант с завершением процесса с учётом асинхронных задач:

```javascript
async function shutdown() {
  await closeConnections() // Закрываем соединения
  console.log("Все задачи завершены. Закрываем приложение")
  process.exit(0)
}

shutdown()
```

Использование **`process.exit()`** — это прямой и быстрый способ завершения приложения, но важно учитывать его недостатки, чтобы избежать потери данных или незавершённых операций.

---

[[002 Node.js|Назад]]

---
title: Отношение "многие ко многим"
draft: false
tags:
  - SQL
  - БД
info:
---

Элементы из обеих таблиц могут быть связаны с несколькими элементами из другой таблицы. Требует промежуточную таблицу.

### Пример: Студенты и Курсы

```sql
-- Создание таблицы студентов
CREATE TABLE students (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    enrollment_date DATE NOT NULL
);

-- Создание таблицы курсов
CREATE TABLE courses (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    credits INT NOT NULL
);

-- Промежуточная таблица для связи многие-ко-многим
CREATE TABLE student_courses (
    student_id INT,
    course_id INT,
    enrollment_date DATE DEFAULT CURRENT_DATE,
    grade DECIMAL(3,2),
    PRIMARY KEY (student_id, course_id),
    FOREIGN KEY (student_id) REFERENCES students(id),
    FOREIGN KEY (course_id) REFERENCES courses(id)
);

-- Вставка данных
INSERT INTO students (name, email, enrollment_date) VALUES
('Алексей Петров', 'alex@example.com', '2023-09-01'),
('Мария Иванова', 'maria@example.com', '2023-09-01'),
('Дмитрий Сидоров', 'dmitry@example.com', '2023-09-01');

INSERT INTO courses (name, description, credits) VALUES
('Математика', 'Основы математического анализа', 4),
('Физика', 'Классическая механика', 3),
('Программирование', 'Основы программирования на Python', 5);

INSERT INTO student_courses (student_id, course_id, grade) VALUES
(1, 1, 4.5),  -- Алексей изучает математику
(1, 3, 5.0),  -- Алексей изучает программирование
(2, 1, 4.0),  -- Мария изучает математику
(2, 2, 4.8),  -- Мария изучает физику
(3, 2, 3.5),  -- Дмитрий изучает физику
(3, 3, 4.2);  -- Дмитрий изучает программирование
```

Запросы для демонстрации связей

```sql
-- Получить всех авторов с их книгами (один ко многим)
SELECT a.name, b.title
FROM authors a
LEFT JOIN books b ON a.id = b.author_id;

-- Получить пользователей с паспортными данными (один к одному)
SELECT u.username, p.first_name, p.last_name, p.passport_number
FROM users u
JOIN passport_data p ON u.id = p.user_id;

-- Получить студентов с их курсами (многие ко многим)
SELECT s.name, c.name, sc.grade
FROM students s
JOIN student_courses sc ON s.id = sc.student_id
JOIN courses c ON sc.course_id = c.id
ORDER BY s.name, c.name;
```

___

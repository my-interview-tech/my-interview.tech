---
title: API3-2019 Excessive Data Exposure
draft: true
tags:
  - infosec
  - OWASP
info:
---

**API3:2019 Excessive Data Exposure** (Выдача избыточной информации)

«_Разработчики, как правило, раскрывают все свойства объекта без учета категории его конфиденциальности, полагаясь на то, что клиент сам выполнит фильтрацию данных перед отображением пользователю_».

На запрос клиента сервер, как правило, формирует запрос к базе данных, которая возвращает запись или список записей. Эти данные зачастую сериализируются в JSON без проверок и отправляются клиенту с предположением, что клиент сам отфильтрует нужные данные. Но проблема в том, что запрос может отправить не только клиент, но и злоумышленник напрямую к серверу, и получить вместе с ним конфиденциальные данные.

Примеры сценариев атаки

1) Команда мобильного приложения использует точку входа `/api/articles/{articleId}/comments/{commentId}` для отображения метаданных комментариев в представлении статей. Злоумышленник перехватывает трафик от мобильного приложения и находит в ответе дополнительные критичные данные об авторе комментария. Точка входа реализована так, что использует стандартный метод toJSON() на объекте модели User, содержащем персональные данные, для сериализации этого объекта.

2) Система видеонаблюдения, базирующаяся на IOT, позволяет администраторам создавать пользователей с различными привилегиями. Администратор создал учетную запись для нового охранника, которая должна иметь доступ только к определенным зданиям на объекте. Когда охранник использует мобильное приложение, оно отправляет запрос в точку входа `/api/sites/111/cameras`, чтобы получить данные о доступных камерах и отобразить их на панели управления. Ответ API содержит список данных о камерах в следующем формате: `{"id":"xxx","live_access_token":"xxxx-bbbbb","building_id":"yyy"}`. Клиентское приложение показывает только те камеры, к которым охранник имеет доступ, однако ответ API содержит полный список камер на объекте.

3) Безобидный запрос данных по пользователю с ID 1: `GET /users/1` может вернуть не только имя/возраст, но и ответ на секретный вопрос, который пользователь задал во время регистрации:  `{"userName":"Alex","age":25,"secretAnswer":"HelloWorld"}`

Это и называется передачей избыточных данных. Проблема усугубляется тем, что данных может быть много по объёму. При больших нагрузках это приведет к сетевым проблемам. Соответственно, при разработке API нельзя полагаться на фильтрацию данных клиентом — все данные должны фильтроваться сразу на сервере. Используя области действия (`scopes`) и утверждения (`claims`), разработчики могут точно определить, кто и к чему имеет право доступа. Claims могут содержать детали того, к каким частям данных следует разрешить доступ. Дополнительным преимуществом является то, что код API становится проще и удобнее в обслуживании, если контроль доступа структурирован одинаково.

Как предотвратить:

- не рассчитывайте, что клиентская часть приложения отфильтрует критичные данные.

- проверьте, что ответы API содержат только те данные, которые отображаются клиентским приложением.

- разработчики серверной части должны всегда задаваться вопросом "Кто получит данные?" перед публикацией новых точек входа API.

- избегайте использования стандартных методов, например, to_json() или to_string(). Вместо этого вручную выбирайте свойства объектов, которые вы возвращаете в ответе.

- классифицируйте критичную информацию и персональные данные, с которыми работает приложение, путем анализа всех вызовов API, возвращающих подобные данные, чтобы определить, несут ли эти ответы риски безопасности.

- внедрите механизм валидации, базирующийся на проверке данных по схеме, в качестве дополнительного уровня защиты. В рамках этого механизма определите данные возвращаемые каждой точкой входа (в том числе в ошибках) и обеспечьте, что только эти данные возвращаются пользователю.

___

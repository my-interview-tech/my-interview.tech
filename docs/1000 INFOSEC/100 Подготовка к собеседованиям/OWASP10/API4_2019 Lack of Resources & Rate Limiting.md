---
title: API4-2019 Lack of Resources & Rate Limiting
draft: true
tags:
  - infosec
  - OWASP
info:
---

**API4:2019 Lack of Resources & Rate Limiting** (Отсутствие ограничений на потребляемые ресурсы и частоту запросов) «_Довольно часто API не накладывают никаких ограничений на размер или количество ресурсов, которые могут быть запрошены клиентом / пользователем. Это не только может повлиять на производительность сервера API, что приведет к отказу в обслуживании (DoS), но также оставляет дверь открытой для атак, таких как подбор пароля_».

Запросы к API потребляют ресурсы: пропускную способность канала, процессорное время, оперативную память, место в хранилище данных. Количество ресурсов, потребляемых для ответа на запрос к API, во многом зависит от пользовательского ввода и бизнес логики точки входа. Кроме того, нужно принимать во внимание то, что запросы от различных клиентов API используют ресурсы совместно. API уязвимо, если хотя бы одно из следующих ограничений отсутствует или имеет некорректное значение (например, слишком высокое или низкое):

- максимальное время ожидания выполнения

- максимальный объем выделяемой памяти

- количество файловых дескрипторов

- количество процессов

- размер полезной нагрузки запроса (например, размер загружаемого файла)

- количество запросов на одного клиента или ресурс

- количество записей из базы данных, возвращаемых в ответе на один запрос

Примеры сценариев атак:

1) Злоумышленник загружает большое изображение, отправив POST запрос на `/api/v1/images`. После завершения загрузки, API создает миниатюры изображения разного размера. Во время создания миниатюр приложение использует всю доступную память и перестает отвечать на запросы из-за большого размера загруженного изображения.

2) Рассмотрим приложение, отображающее список пользователей в пользовательском интерфейсе с ограничением 200 строк на страницу. Для получения списка пользователей приложение отправляет следующий запрос на сервер: `/api/users?page=1&size=100`. Злоумышленник увеличивает size до 200 000, что приводит к проблемам производительности в базе данных. API перестает отвечать на запросы и больше не может обработать запросы текущего или любого другого клиента (отказ в обслуживании).

Для защиты нужно реализовать следующие ограничения:

- ограничить число неудачных попыток авторизации одного пользователя. Как вариант использовать reCapture или аналогичный механизм;

- блокировать IP, если число неудачных попыток с него превысило определенное значение по всем пользователям (e.g., fail2ban). Есть возможности, позволяющие делать такие проверки автоматически (Rate limiter) и сразу посылать ответ 429 Too Many Requests, не нагружая сервер. Необходимо защитить сервер и от отказа в обслуживании (DoS-атаки):

- ограничить частоту запросов от одного пользователя или по одному ресурсу (Quota, Spike Arrest, Concurrent Rate Limit);

- уведомить клиента, когда ограничение превышено, предоставив ему значение ограничения и время, когда ограничение будет сброшено;

- ограничить передачу заведомо больших значений, например, сервер ожидает в параметре size число записей. Проверяйте все значения параметров на допустимость именно на сервере, даже если такие проверки есть на клиенте. Ведь ничто не мешает вызвать API напрямую.

___

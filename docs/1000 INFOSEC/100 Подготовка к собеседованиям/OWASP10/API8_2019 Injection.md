---
title: API8-2019 Injection
draft: true
tags:
  - infosec
  - OWASP
info:
---

**API8:2019** **Injection** (Внедрение кода)

_Внедрение — это выполнение программного кода, непредусмотренного системой_. Разделяют внедрения SQL, JS, XML, LDAP, команд ОС (bash, powershell и т. п.).

API уязвим к инъекциям, если:

- Данные, поступившие от пользователя (или из интегрированных систем), не валидируются, не фильтруются или не очищаются на стороне API.

- Данные, поступившие от пользователя, конкатенируются или используются в неизменном виде в SQL/NoSQL/LDAP-запросах, командах на операционной системе, XML парсерах, ORM (Object Relational Mapping) или ODM (Object Document Mapper).

Пример сценария атаки:

Рассмотрим приложение с базовым CRUD-функционалом для операций с бронированиями. Злоумышленник обнаружил NoSQL инъекцию через параметр bookingId в запросе на удаление бронирования. Запрос выглядит следующим образом: DELETE `/api/bookings?bookingId=678`.

Сервер API обрабатывает запросы на удаление с помощью следующей функции:

```js
router.delete('/bookings', async function (req, res, next) {

  try {

      const deletedBooking = await Bookings.findOneAndRemove({'_id' : req.query.bookingId});

      res.status(200);

  } catch (err) {

     res.status(400).json({error: 'Unexpected error occured while processing a request'});

  }

});
```

Злоумышленник перехватывает запрос и изменяет параметр bookingId, как продемонстрировано ниже. В этом случае злоумышленник может удалить бронирование, принадлежащее другому пользователю:

DELETE `/api/bookings?bookingId[$ne]=678`

Как предотвратить:

- Для предотвращения инъекций необходимо отделять данные от команд и запросов -- не разрешайте SQL, JS, powershell и т.п. в качестве допустимых форматов входных данных.

- Валидируйте данные, используя доверенную и активно поддерживаемую библиотеку.

- Валидируйте, фильтруйте и очищайте все данные, получаемые от клиентов или интегрированных систем.

- Специальные символы должны быть экранированы, используя синтаксис целевого интерпретатора.

- Предпочтение безопасному API, предоставляющему параметризированный интерфейс.

- Ограничивайте количество возвращаемых записей, чтобы предотвратить массовую утечку данных в случае инъекции.

- Валидируйте входящие данные с помощью надлежащих фильтров, допуская только уместные значения каждого из входящих параметров.

- Определите тип данных и строгую модель данных для всех строковых параметров.

___

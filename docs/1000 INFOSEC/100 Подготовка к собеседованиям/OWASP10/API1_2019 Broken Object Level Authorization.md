---
title: API1-2019 Broken Object Level Authorization
draft: true
tags:
  - infosec
  - OWASP
info:
---

**API1:2019 Broken Object Level Authorization** (Некорректная авторизация на уровне объектов) “_Конечные точки_ _API обычно открыты всем, создавая проблему контроля доступа с большой поверхностью атаки. Проверку авторизации на уровне объекта следует делать в каждой функции, которая обращается к источнику данных с использованием ввода от пользователя._” Другое название этого риска: Insecure Direct Object References (небезопасные прямые ссылки на объекты).

Примеры сценариев атаки:

1) Торговая онлайн платформа для онлайн магазинов предоставляет страницу с графиками доходов для каждого размещенного на платформе магазина. Злоумышленник, проанализировав отправляемые браузером запросы, может найти точки входа API, предоставляющие данные для графиков и определить формат запросов к ним `/shops/{shopName}/revenue_data.json`. Используя другую точку входа API, злоумышленник может получить список названий всех магазинов, размещенных на платформе. Используя простой скрипт, заменяющий `{shopName}` в URL запроса на названия магазинов, злоумышленник может получить доступ к данным о продажах тысяч онлайн магазинов.

2) Злоумышленник анализирует сетевой трафик носимого устройства, и HTTP PATCH запрос, содержащий нестандартный HTTP заголовок X-User-Id: 54796, привлекает его внимание. Изменив значение заголовка X-User-Id на 54795, злоумышленник получает ответ сервера, означающий успешную обработку запроса. Это означает, что злоумышленник может изменять данные учетных записей других пользователей.

Для иллюстрации:

Получить информацию по одному пользователю с userID:

`GET /users/{userID}`

Получить информацию обо всех пользователях (может только администратор):

`GET /users`

Удалить пользователя c userID:

`DELETE /users/1`

Если вызывается команда удаления пользователя, то необходима проверка, что эту команду может вызвать только сам пользователь 1 или администратор, а не, например, пользователь 2 от своего имени, изменив значение ID в вызове команды. Чтобы избежать подобных проблем необходимо:

- Проверять права доступа к объектам при каждом запросе (access token) и разрешать доступ только тем, у кого есть надлежащие учетные данные и соответствующий сертификат TLS.

- Проверять, что пользователь имеет доступ к разрешенным объектам (scope, claims).

- ID объектов должны быть сложными для подбора, например UUID (RFC4122), а не простая последовательность (1, 2, 3,...).

___
